(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).kernel={})})(this,function(t){"use strict";function e(t){return function(e){const n=function(t,e,r){DI.inject(n)(t,e,r)};return n.resolve=function(n,r){return t(e,n,r)},n}}function n(t){return DI.transient(t)}function r(t){return DI.singleton(t)}function i(t){return"function"==typeof t.register}function o(t){if(null==t||t===Object)throw Reporter.error(5)}function s(t,e,n){if(t instanceof I&&4===t.strategy){const r=t.state;let i=r.length;const o=[];for(;i--;)o[i]=r[i].resolve(e,n);return o}return[t.resolve(e,n)]}function l(t,e,n,r){let i,o=n.length,s=[];for(;o--;){if(null==(i=n[o]))throw Reporter.error(7,`Index ${o}.`);s[o]=t.get(i)}return void 0!==r&&(s=s.concat(r)),Reflect.construct(e,s)}function u(t,value,e){let n=[];if(null==value)return n;if(Array.isArray(value))for(let r=0,i=value.length;i>r;r++)e?n.push(`${S(t)}=${P(value[r])}`):n=n.concat(u(`${t}[${"object"==typeof value[r]&&null!=value[r]?r:""}]`,value[r]));else if("object"!=typeof value||e)n.push(`${S(t)}=${P(value)}`);else for(const e in value)n=n.concat(u(`${t}[${e}]`,value[e]));return n}function c(t,value){return Array.isArray(t)?(t.push(value),t):void 0!==t?[t,value]:value}function f(t,e,value){let n=t;const r=e.length-1;let i,o;for(let t=0;r>=t;++t)n=n[i=""===e[t]?n.length:e[t]]=r>t?(o=n[i]&&"object"!=typeof n[i]?[n[i]]:n[i])||(isNaN(e[t+1])?{}:[]):value}function a(t,e,n){try{t(e,n)}catch(t){Reporter.error(0,t)}}function d(t,e){try{t.t(e)}catch(t){Reporter.error(0,t)}}var LogLevel,p;const y=(function(){if("undefined"!=typeof global)return global;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;try{return Function("","return this")()}catch(t){return{}}})(),w="undefined"!=typeof window&&void 0!==window.document,m="object"==typeof self&&null!=self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,g="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,v=(function(){let t,e,n,r,i;if(null!=y.performance&&null!=y.performance.now){const t=y.performance;return function(){return t.now()}}if(null!=y.process&&null!=y.process.i){const o=function(){return(t()-r)/1e6};return e=y.process.i,n=(t=function(){let t;return 1e9*(t=e())[0]+t[1]})(),i=1e9*y.process.o(),r=n-i,o}throw Error("Unsupported runtime")})(),{s:b,l:$,u:k,p:j,m:T,g:O}=(function(){if(null!=y.performance&&null!=y.performance.mark&&null!=y.performance.measure&&null!=y.performance.getEntriesByName&&null!=y.performance.getEntriesByType&&null!=y.performance.clearMarks&&null!=y.performance.clearMeasures){const t=y.performance;return{s(name){t.mark(name)},l(name,e,n){t.measure(name,e,n)},u:name=>t.getEntriesByName(name),p:type=>t.getEntriesByType(type),m(name){t.clearMarks(name)},g(name){t.clearMeasures(name)}}}if(null!=y.process&&null!=y.process.i){const t=[],e={},n=function(e,value){let n=0;const r=t.length,i=[];for(;r>n;n++)t[n][e]===value&&i.push(t[n]);return i},r=function(type,name){let e,n=t.length;for(;n--;)(e=t[n]).entryType!==type||void 0!==name&&e.name!==name||t.splice(n,1)};return{s(name){const n={name,entryType:"mark",startTime:v(),duration:0};t.push(n),e[name]=n},l(name,n,r){let i,o;if(null!=r){if(null==e[r])throw new SyntaxError(`Failed to execute 'measure' on 'Performance': The mark '${r}' does not exist.`);o=void 0!==e[r]?e[r].startTime:v()}else o=v();if(null!=n){if(null==e[n])throw new SyntaxError(`Failed to execute 'measure' on 'Performance': The mark '${n}' does not exist.`);i=void 0!==e[n]?e[n].startTime:0}else i=0;t.push({name,entryType:"measure",startTime:i,duration:o-i})},u:name=>n("name",name),p:type=>n("entryType",type),m(name){r("mark",name)},g(name){r("measure",name)}}}throw Error("Unsupported runtime")})(),{v:D,$:E}=(function(){let t=y.requestAnimationFrame,e=y.cancelAnimationFrame;if(void 0===t||void 0===e){let n=0,r=0;const i=[],o=1e3/60;t=function(t){let e,s;return 0===i.length&&(e=v(),n=(s=Math.max(0,o-(e-n)))+e,setTimeout(function(){const t=i.slice(0);i.length=0;for(let e=0;t.length>e;++e)if(!t[e].k)try{t[e].j(n)}catch(t){setTimeout(function(){throw t},0)}},Math.round(s))),i.push({t:++r,j:t,k:0}),r},e=function(t){for(let e=0;i.length>e;++e)i[e].t===t&&(i[e].k=1)}}const n=function(e){return t.call(y,e)};return n.cancel=function(t){e.call(y,t)},y.requestAnimationFrame=t,y.cancelAnimationFrame=e,{v:n,$:e}})(),C={}.hasOwnProperty,M=Object.freeze([]),R=Object.freeze({}),W=Object.freeze({T:w,O:m,D:g,global:y,C:M,M:R,R(){},now:v,mark:b,measure:$,getEntriesByName:k,getEntriesByType:j,clearMarks:T,clearMeasures:O,hasOwnProperty:C,requestAnimationFrame:t=>D(t),cancelAnimationFrame:t=>E(t),clearInterval(t){y.clearInterval(t)},clearTimeout(t){y.clearTimeout(t)},setInterval:(t,e,...n)=>y.setInterval(t,e,...n),setTimeout:(t,e,...n)=>y.setTimeout(t,e,...n),restore(){Object.assign(PLATFORM,W)}}),PLATFORM={...W};(LogLevel=t.LogLevel||(t.LogLevel={}))[LogLevel.error=0]="error",LogLevel[LogLevel.warn=1]="warn",LogLevel[LogLevel.info=2]="info",LogLevel[LogLevel.debug=3]="debug";const Reporter={level:1,write(t,...e){},error:t=>Error(`Code ${t}`)},Tracer={enabled:0,W:0,A:null,I(t,e,n){},L(){},B(t){},F(t){},N(){},U(){}},x=[].slice;"getOwnMetadata"in Reflect||(Reflect.getOwnMetadata=function(t,e){return e[t]},Reflect.metadata=function(t,e){return function(n){n[t]=e}});const A=PLATFORM.hasOwnProperty;class DI{constructor(){}static P(...t){return 0===t.length?new F:(new F).register(...t)}static S(t){const e=Reflect.getOwnMetadata("design:paramtypes",t);return null==e?PLATFORM.C:e}static q(t){let dependencies;if(null==t.inject)dependencies=DI.S(t);else{dependencies=[];let e=t;for(;"function"==typeof e;)A.call(e,"inject")&&dependencies.push(...e.inject),e=Object.getPrototypeOf(e)}return dependencies}static G(t){const e=function(t,n,r){if(null==t)throw Reporter.error(16,e.H,e);return null==t.inject&&(t.inject=[]),t.inject[r]=e,t};return e.H=null==t?"Interface":t,e.J=function(){return e},e.K=function(t){return e.K=function(){throw Reporter.error(17,e)},e.register=function(n,r){const i=null==r?e:r;return t({V:value=>n.X(i,new I(i,0,value)),singleton:value=>n.X(i,new I(i,1,value)),transient:value=>n.X(i,new I(i,2,value)),j:value=>n.X(i,new I(i,3,value)),Y:t=>n.X(i,new I(i,5,t))})},e},e}static inject(...dependencies){return function(t,e,n){if("number"==typeof n){if(!A.call(t,"inject")){const e=DI.S(t);t.inject=e.slice()}1===dependencies.length&&(t.inject[n]=dependencies[0])}else if(e){const n=t.constructor;null==n.inject&&(n.inject=[]),n.inject[e]=dependencies[0]}else if(n)n.value.inject=dependencies;else if(0===dependencies.length){const e=DI.S(t);t.inject=e.slice()}else t.inject=dependencies}}static transient(t){return t.register=function(e){return Registration.transient(t,t).register(e,t)},t}static singleton(t){return t.register=function(e){return Registration.singleton(t,t).register(e,t)},t}}const IContainer=DI.G("IContainer").J(),IServiceLocator=IContainer,inject=DI.inject,all=e((t,e,n)=>n.getAll(t)),lazy=e((t,e,n)=>{let r=null;return()=>(null==r&&(r=n.get(t)),r)}),optional=e((t,e,n)=>n.has(t,1)?n.get(t):null);(function(t){t[t.V=0]="instance",t[t.singleton=1]="singleton",t[t.transient=2]="transient",t[t.j=3]="callback",t[t.Z=4]="array",t[t.tt=5]="alias"})(p||(p={}));class I{constructor(t,strategy,e){this.key=t,this.strategy=strategy,this.state=e}register(t,e){return t.X(e||this.key,this)}resolve(t,e){switch(this.strategy){case 0:return this.state;case 1:{this.strategy=0;const e=t.et(this.state);return this.state=e.construct(t)}case 2:return t.et(this.state).construct(e);case 3:return this.state(t,e,this);case 4:return this.state[0].resolve(t,e);case 5:return t.get(this.state);default:throw Reporter.error(6,this.strategy)}}et(t){switch(this.strategy){case 1:case 2:return t.et(this.state);default:return null}}}class L{constructor(t,e,dependencies){this.nt=t,this.rt=e,this.dependencies=dependencies,this.it=null}static create(t){const dependencies=DI.q(t);return new L(t,N.length>dependencies.length?N[dependencies.length]:U,dependencies)}construct(t,e){Tracer.enabled&&Tracer.I("Factory","construct",[this.nt,...x.call(arguments)]);const n=this.it;let r=void 0!==e?this.rt.ot(t,this.nt,this.dependencies,e):this.rt.st(t,this.nt,this.dependencies);if(null==n)return Tracer.enabled&&Tracer.L(),r;for(let t=0,e=n.length;e>t;++t)r=n[t](r);return Tracer.enabled&&Tracer.L(),r}lt(t){return null==this.it&&(this.it=[]),this.it.push(t),1}}const B={resolve:(t,e)=>e};class F{constructor(t={}){this.parent=null,this.ut=0,this.ct=new Map,this.ft=t,null==t.at&&(t.at=new Map),this.at=t.at,this.ht=t.ht||(t.ht=Object.create(null)),this.ct.set(IContainer,B)}register(...t){if(Tracer.enabled&&Tracer.I("Container","register",x.call(arguments)),100==++this.ut)throw Error("Unable to autoregister dependency");let e,n,value,r,o;for(let s=0,l=t.length;l>s;++s)if(i(e=t[s]))e.register(this);else if(void 0!==e.prototype)Registration.singleton(e,e).register(this);else for(r=0,o=(n=Object.keys(e)).length;o>r;++r)i(value=e[n[r]])?value.register(this):this.register(value);return--this.ut,Tracer.enabled&&Tracer.L(),this}X(t,e){o(t);const n=this.ct,r=n.get(t);return null==r?(n.set(t,e),"string"==typeof t&&(this.ht[t]=e)):r instanceof I&&4===r.strategy?r.state.push(e):n.set(t,new I(t,4,[r,e])),e}lt(t,e){const n=this.dt(t);if(null==n)return 0;if(n.et){const t=n.et(this);return null==t?0:t.lt(e)}return 0}dt(t,e=1){if(o(t),void 0!==t.resolve)return t;let n,r=this;for(;null!=r;){if(null!=(n=r.ct.get(t)))return n;if(null==r.parent)return e?this.pt(t,r):null;r=r.parent}return null}has(t,e=0){return this.ct.has(t)?1:e&&null!=this.parent?this.parent.has(t,1):0}get(t){if(Tracer.enabled&&Tracer.I("Container","get",x.call(arguments)),o(t),void 0!==t.resolve)return Tracer.enabled&&Tracer.L(),t.resolve(this,this);let e,n=this;for(;null!=n;){if(null!=(e=n.ct.get(t)))return Tracer.enabled&&Tracer.L(),e.resolve(n,this);if(null==n.parent)return e=this.pt(t,n),Tracer.enabled&&Tracer.L(),e.resolve(n,this);n=n.parent}throw Error(`Unable to resolve key: ${t}`)}getAll(t){Tracer.enabled&&Tracer.I("Container","getAll",x.call(arguments)),o(t);let e,n=this;for(;null!=n;){if(null!=(e=n.ct.get(t)))return Tracer.enabled&&Tracer.L(),s(e,n,this);if(null==this.parent)return Tracer.enabled&&Tracer.L(),PLATFORM.C;n=n.parent}return Tracer.enabled&&Tracer.L(),PLATFORM.C}et(t){let e=this.at.get(t);return null==e&&(e=L.create(t),this.at.set(t,e)),e}yt(){Tracer.enabled&&Tracer.I("Container","createChild",x.call(arguments));const t=this.ft,e={at:t.at,ht:Object.assign(Object.create(null),t.ht)},n=new F(e);return n.parent=this,Tracer.enabled&&Tracer.L(),n}pt(t,e){if(void 0!==t.register){const n=t.register(e,t);if(!(n instanceof Object)||null==n.resolve){const n=e.ct.get(t);if(null!=n)return n;throw Reporter.error(40)}return n}const n=new I(t,1,t);return e.ct.set(t,n),n}}class Registration{constructor(){}static V(t,value){return new I(t,0,value)}static singleton(t,value){return new I(t,1,value)}static transient(t,value){return new I(t,2,value)}static j(t,e){return new I(t,3,e)}static tt(t,e){return new I(e,5,t)}}const N=[{st:(t,e)=>new e,ot:l},{st:(t,e,n)=>new e(t.get(n[0])),ot:l},{st:(t,e,n)=>new e(t.get(n[0]),t.get(n[1])),ot:l},{st:(t,e,n)=>new e(t.get(n[0]),t.get(n[1]),t.get(n[2])),ot:l},{st:(t,e,n)=>new e(t.get(n[0]),t.get(n[1]),t.get(n[2]),t.get(n[3])),ot:l},{st:(t,e,n)=>new e(t.get(n[0]),t.get(n[1]),t.get(n[2]),t.get(n[3]),t.get(n[4])),ot:l}],U={st:l,ot:l},P=encodeURIComponent,S=t=>P(t).replace("%24","$"),Profiler=(function(){const t=PLATFORM.now,e=[];let n;const r={wt(name){e.push(name);let r=0,i=0;return{I(){1==++r&&(i=t(),++n[name].gt),++n[name].vt},L(){0==--r&&(n[name].duration+=t()-i)}}},enable(){n={};for(const t of e)n[t]={name:t,duration:0,gt:0,vt:0};r.enabled=1},disable(){r.enabled=0},bt(t){Object.keys(n).map(t=>n[t]).sort((t,e)=>e.duration-t.duration).forEach(e=>{t(e.name,e.duration,e.gt,e.vt)})},enabled:0};return r})();class q{constructor(t,e){this.$t=t,this.j=e}t(t){t instanceof this.$t&&this.j.call(null,t)}}const IEventAggregator=DI.G("IEventAggregator").K(t=>t.singleton(EventAggregator));class EventAggregator{constructor(){this.kt={},this.messageHandlers=[]}jt(t,e){let n,r;if(!t)throw Reporter.error(0);if("string"==typeof t){const i=t;if(null!=(n=this.kt[i]))for(r=(n=n.slice()).length;r--;)a(n[r],e,i)}else{const e=t;for(r=(n=this.messageHandlers.slice()).length;r--;)d(n[r],e)}}subscribe(t,e){let n,r;if(!t)throw Reporter.error(0);if("string"==typeof t){const i=t;n=e,void 0===this.kt[i]&&(this.kt[i]=[]),r=this.kt[i]}else n=new q(t,e),r=this.messageHandlers;return r.push(n),{Tt(){const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}}Ot(t,e){const n=this.subscribe(t,(t,r)=>(n.Tt(),e(t,r)));return n}}const G={},z={},H={},J={};t.DI=DI,t.EventAggregator=EventAggregator,t.IContainer=IContainer,t.IEventAggregator=IEventAggregator,t.IServiceLocator=IServiceLocator,t.InstanceProvider=class{constructor(){this.V=null}Dt(t){this.V=t}resolve(t,e){if(void 0===this.V)throw Reporter.error(50);return this.V}Tt(){this.V=null}},t.PLATFORM=PLATFORM,t.Profiler=Profiler,t.Registration=Registration,t.Reporter=Reporter,t.RuntimeCompilationResources=class{constructor(t){this.context=t}find(t,name){const e=t.Et(name),n=this.context.ht;let r=n[e];if(void 0===r&&(r=n[e]=this.context.dt(e,0)),null!=r&&r.et){const t=r.et(this.context);if(null!=t){const e=t.nt.description;return void 0===e?null:e}}return null}create(t,name){const e=t.Et(name),n=this.context.ht;let r=n[e];if(void 0===r&&(r=n[e]=this.context.dt(e,0)),null!=r){const t=r.resolve(this.context,this.context);return void 0===t?null:t}return null}},t.Tracer=Tracer,t.all=all,t.buildQueryString=function(t,e){if(null==t)return"";const n=[],r=Object.keys(t).sort();let i;for(let o=0,s=r.length;s>o;++o)n.push(...u(i=r[o],t[i],e));return 0===n.length?"":n.join("&")},t.camelCase=function(t){let value=G[t];if(void 0!==value)return value;value="";let e,n=1,r=0;for(let i=0,o=t.length;o>i;++i)"-"===(e=t.charAt(i))||"."===e||"_"===e?r=1:(value+=n?e.toLowerCase():r?e.toUpperCase():e,r=0),n=0;return G[t]=value},t.compareNumber=function(t,e){return t-e},t.inject=inject,t.isNumeric=function(value){switch(typeof value){case"number":return 1;case"string":{const t=H[value];if(void 0!==t)return t;const{length:e}=value;if(0===e)return H[value]=0;let n=0;for(let t=0;e>t;++t)if(48>(n=value.charCodeAt(t))||n>57)return H[value]=0;return H[value]=1}default:return 0}},t.join=function(t,e){if(!t)return e;if(!e)return t;const n=t.match(/^([^\/]*?:)\//),r=n&&n.length>0?n[1]:"";let i;i=0===(t=t.slice(r.length)).indexOf("///")&&"file:"===r?"///":0===t.indexOf("//")?"//":0===t.indexOf("/")?"/":"";const o="/"===e.slice(-1)?"/":"",s=t.split("/"),l=e.split("/"),u=[];for(let t=0,e=s.length;e>t;++t)".."===s[t]?u.pop():"."!==s[t]&&""!==s[t]&&u.push(s[t]);for(let t=0,e=l.length;e>t;++t)".."===l[t]?u.pop():"."!==l[t]&&""!==l[t]&&u.push(l[t]);return r+i+u.join("/")+o},t.kebabCase=function(t){let value=z[t];if(void 0!==value)return value;value="";let e,n,r=1;for(let i=0,o=t.length;o>i;++i)n=(e=t.charAt(i)).toLowerCase(),value+=r?n:e!==n?`-${n}`:n,r=0;return z[t]=value},t.lazy=lazy,t.nextId=function(t){return void 0===J[t]&&(J[t]=0),++J[t]},t.optional=optional,t.parseQueryString=function(t){const e={};if(!t||"string"!=typeof t)return e;let n=t;"?"===n.charAt(0)&&(n=n.slice(1));const r=n.replace(/\+/g," ").split("&");for(let t=0;r.length>t;t++){const n=r[t].split("="),i=decodeURIComponent(n[0]);if(!i)continue;let o=i.split("]["),s=o.length-1;if(/\[/.test(o[0])&&/\]$/.test(o[s])?(o[s]=o[s].replace(/\]$/,""),s=(o=o.shift().split("[").concat(o)).length-1):s=0,2>n.length)e[i]=1;else{const value=n[1]?decodeURIComponent(n[1]):"";s?f(e,o,value):e[i]=c(e[i],value)}}return e},t.relativeToFile=function(name,t){const e=t?t.split("/"):t,n=name.trim().split("/");if("."===n[0].charAt(0)&&e){const t=e.slice(0,e.length-1);n.unshift(...t)}return(function(t){const e=t.length;let n,r=0;for(;e>r;++r)if("."===(n=t[r]))t.splice(r,1),r-=1;else if(".."===n){if(0===r||1===r&&".."===t[2]||".."===t[r-1])continue;r>0&&(t.splice(r-1,2),r-=2)}})(n),n.join("/")},t.resetId=function(t){J[t]=0},t.singleton=function(t){return null==t?r:r(t)},t.toArray=function(t){const{length:e}=t,n=Array(e);for(let r=0;e>r;++r)n[r]=t[r];return n},t.transient=function(t){return null==t?n:n(t)},Object.defineProperty(t,"Ct",{value:1})});
