function processInterpolationText(t){const e=t.t,n=e.parentNode;for(;null!=e.nextSibling&&3===e.nextSibling.nodeType;)n.removeChild(e.nextSibling);e.textContent="",n.insertBefore(t.marker,e)}function processTemplateControllers(dom,t,e){const n=e.t;let i,r=t;for(;r!==e;)r.template===e?(n.parentNode.replaceChild(r.marker,n),"TEMPLATE"===n.nodeName?(r.t=n,n.remove()):(i=r.t=dom.i()).content.appendChild(n)):(i=r.t=dom.i()).content.appendChild(r.marker),n.removeAttribute(r.l.s),r=r.template}function processReplacePart(dom,t,e){let n,i;"TEMPLATE"===(n=512&e.flags?e.marker:e.t).nodeName?t.t=n:(i=t.t=dom.i()).content.appendChild(n)}function parseMultiAttributeBinding(t){const e=[],n=new ParserState(t),i=n.length;let name,value;for(;i>n.index;){if(0===(name=scanAttributeName(n)).length)return e;value=scanAttributeValue(n),e.push({name,value})}return e}function scanAttributeName(t){const e=t.index,{length:n,input:i}=t;for(;n>t.index&&58!==i.charCodeAt(++t.index););return i.slice(e,t.index).trim()}function scanAttributeValue(t){++t.index;const{length:e,input:n}=t;let i="",r=0;for(;e>t.index;){switch(r=n.charCodeAt(t.index)){case 59:return++t.index,i.trim();case 47:r=n.charCodeAt(++t.index),i+=`\\${fromCharCode(r)}`;break;case 39:i+="'";break;default:i+=fromCharCode(r)}++t.index}return i.trim()}function stringifyDOM(t,e){let n=" ".repeat(e);if(n+=`Node: ${t.nodeName}`,3===t.nodeType&&(n+=` "${t.textContent}"`),1===t.nodeType){let e,i=0;const r=t.attributes,s=r.length;for(;s>i;++i)n+=` ${(e=r[i]).name}=${e.value}`}if(n+="\n",1===t.nodeType){let i=0,childNodes=t.childNodes,r=childNodes.length;for(;r>i;++i)n+=stringifyDOM(childNodes[i],e+1);if("TEMPLATE"===t.nodeName)for(i=0,r=(childNodes=t.content.childNodes).length;r>i;++i)n+=stringifyDOM(childNodes[i],e+1)}return n}function stringifyInstructions(t,e){let n=" ".repeat(e);switch(t.type){case"ha":n+="textBinding\n";break;case"rh":n+="callBinding\n";break;case"rk":n+="iteratorBinding\n";break;case"hb":n+="listenerBinding\n";break;case"rg":n+="propertyBinding\n";break;case"rj":n+="refBinding\n";break;case"hd":n+="stylePropertyBinding\n";break;case"re":n+="setProperty\n";break;case"he":n+="setAttribute\n";break;case"rf":n+="interpolation\n";break;case"rd":n+="hydrateLetElement\n",t.instructions.forEach(t=>{n+=stringifyInstructions(t,e+1)});break;case"rb":n+=`hydrateAttribute: ${t.res}\n`,t.instructions.forEach(t=>{n+=stringifyInstructions(t,e+1)});break;case"ra":n+=`hydrateElement: ${t.res}\n`,t.instructions.forEach(t=>{n+=stringifyInstructions(t,e+1)});break;case"rc":n+=`hydrateTemplateController: ${t.res}\n`,n+=stringifyTemplateDefinition(t.def,e+1),t.instructions.forEach(t=>{n+=stringifyInstructions(t,e+1)})}return n}function stringifyTemplateDefinition(def,t){const e=" ".repeat(t);let n=e;return n+=`TemplateDefinition: ${def.name}\n`,n+=stringifyDOM(def.template,t+1),n+=`${e} Instructions:\n`,def.instructions.forEach(i=>{n+=`${e}  Row:\n`,i.forEach(e=>{n+=stringifyInstructions(e,t+3)})}),n}import{getTarget,BindingCommandResource,attributePattern,AttrSyntax,PlainElementSymbol,CustomElementSymbol,LetElementSymbol,BindableInfo,BindingSymbol,TextSymbol,TemplateControllerSymbol,CustomAttributeSymbol,PlainAttributeSymbol,ReplacePartSymbol,ResourceModel,IAttributeParser,DefaultComponents as DefaultComponents$1,DefaultBindingSyntax,DefaultBindingLanguage as DefaultBindingLanguage$1}from"@aurelia/jit";import{TriggerBindingInstruction,DelegateBindingInstruction,CaptureBindingInstruction,AttributeBindingInstruction,TextBindingInstruction,SetAttributeInstruction,BasicConfiguration as BasicConfiguration$1}from"@aurelia/runtime-html";import{Profiler,Tracer,camelCase,DI,Registration,PLATFORM}from"@aurelia/kernel";import{BindingMode,IDOM,ITemplateCompiler,LetBindingInstruction,LetElementInstruction,HydrateElementInstruction,HydrateTemplateController,SetPropertyInstruction,InterpolationInstruction,HydrateAttributeInstruction,RefBindingInstruction,IExpressionParser}from"@aurelia/runtime";class TriggerBindingCommand{constructor(){this.o=86}compile(t){return new TriggerBindingInstruction(t.u,getTarget(t,0))}}BindingCommandResource.m("trigger",TriggerBindingCommand);class DelegateBindingCommand{constructor(){this.o=88}compile(t){return new DelegateBindingInstruction(t.u,getTarget(t,0))}}BindingCommandResource.m("delegate",DelegateBindingCommand);class CaptureBindingCommand{constructor(){this.o=87}compile(t){return new CaptureBindingInstruction(t.u,getTarget(t,0))}}BindingCommandResource.m("capture",CaptureBindingCommand);class AttrBindingCommand{constructor(){this.o=32}compile(t){const e=getTarget(t,0);return new AttributeBindingInstruction(e,t.u,e)}}BindingCommandResource.m("attr",AttrBindingCommand);class StyleBindingCommand{constructor(){this.o=32}compile(t){return new AttributeBindingInstruction("style",t.u,getTarget(t,0))}}BindingCommandResource.m("style",StyleBindingCommand);class ClassBindingCommand{constructor(){this.o=32}compile(t){return new AttributeBindingInstruction("class",t.u,getTarget(t,0))}}BindingCommandResource.m("class",ClassBindingCommand);class AttrAttributePattern{g(t,e,parts){return new AttrSyntax(t,e,parts[1],"attr")}T(t,e,parts){return new AttrSyntax(t,e,parts[0],"attr")}}attributePattern({pattern:"attr.PART",symbols:"."},{pattern:"PART.attr",symbols:"."})(AttrAttributePattern);class StyleAttributePattern{p(t,e,parts){return new AttrSyntax(t,e,parts[1],"style")}C(t,e,parts){return new AttrSyntax(t,e,parts[0],"style")}}attributePattern({pattern:"style.PART",symbols:"."},{pattern:"PART.style",symbols:"."})(StyleAttributePattern);class ClassAttributePattern{B(t,e,parts){return new AttrSyntax(t,e,parts[1],"class")}A(t,e,parts){return new AttrSyntax(t,e,parts[0],"class")}}attributePattern({pattern:"class.PART",symbols:"."},{pattern:"PART.class",symbols:"."})(ClassAttributePattern);const slice=[].slice,{P:enter,I:leave}=Profiler.R("TemplateBinder"),invalidSurrogateAttribute={id:1,S:1,D:1},attributesToIgnore={M:1,S:1,D:1};class TemplateBinder{constructor(dom,t,e,n){this.dom=dom,this.L=t,this.v=e,this.$=n,this.k=null,this.manifest=null,this.F=null,this.O=null,this.N=null}bind(t){Tracer.enabled&&Tracer.P("TemplateBinder","bind",slice.call(arguments)),Profiler.enabled&&enter();const e=this.k,n=this.O,i=this.F,r=this.manifest,s=this.k=this.manifest=new PlainElementSymbol(t),a=t.attributes;let l=0;for(;a.length>l;){const t=a[l],e=this.v.parse(t.name,t.value);if(1==invalidSurrogateAttribute[e.target])throw Profiler.enabled&&leave(),Error(`Invalid surrogate attribute: ${e.target}`);const n=this.L.H(e);if(null==n)this.q(e,t);else{if(n.isTemplateController)throw Profiler.enabled&&leave(),Error("Cannot have template controller on surrogate element.");this.j(e,n)}++l}return this.J(t),this.k=e,this.O=n,this.F=i,this.manifest=r,Profiler.enabled&&leave(),Tracer.enabled&&Tracer.I(),s}V(t,e){switch(Tracer.enabled&&Tracer.P("TemplateBinder","bindManifest",slice.call(arguments)),e.nodeName){case"LET":return this.G(t,e),void(Tracer.enabled&&Tracer.I());case"SLOT":this.k.hasSlots=1}const n=this.O,i=this.F,r=this.manifest;this.N=e.getAttribute("part");let s=void 0,name=e.getAttribute("as-element");null==name&&(name=e.nodeName.toLowerCase());const a=this.L.K(name);null==a?this.manifest=new PlainElementSymbol(e):(this.O=this.F,s=this.F=this.manifest=new CustomElementSymbol(this.dom,e,a)),this.J(e),this.U(e,t),null!=s&&s.W?e.parentNode.replaceChild(s.marker,e):this.manifest.X&&e.classList.add("au"),this.O=n,this.F=i,this.manifest=r,Tracer.enabled&&Tracer.I()}G(t,e){const n=new LetElementSymbol(this.dom,e);t.childNodes.push(n);const i=e.attributes;let r=0;for(;i.length>r;){const t=i[r];if("to-view-model"===t.name){e.removeAttribute("to-view-model"),n.toViewModel=1;continue}const s=this.v.parse(t.name,t.value),a=this.L.Y(s),l=this.$.parse(s.Z,null==a?2048:a.o),to=camelCase(s.target),o=new BindableInfo(to,BindingMode.tt);n.et.push(new BindingSymbol(a,o,l,s.Z,to)),++r}e.parentNode.replaceChild(n.marker,e)}U(t,e){Tracer.enabled&&Tracer.P("TemplateBinder","bindAttributes",slice.call(arguments));const{O:n,F:i,manifest:r}=this;let s=r;const a=this.nt(t);let l=void 0,o=void 0;const c=t.attributes;let u=0;for(;c.length>u;){const t=c[u];if(++u,1==attributesToIgnore[t.name])continue;const e=this.v.parse(t.name,t.value),n=this.L.H(e);null==n?this.q(e,t):n.isTemplateController?(o=r.templateController=this.it(e,n),s===r?(o.template=r,s=o):(o.templateController=l,o.template=l.template,l.template=o),l=o):this.j(e,n)}processTemplateControllers(this.dom,s,r),null==a?e.childNodes.push(s):(a.parent=e,a.template=s,(r===i?n:i).parts.push(a),null!=e.templateController&&e.templateController.parts.push(a),processReplacePart(this.dom,a,s)),Tracer.enabled&&Tracer.I()}J(t){let e,n;for(Tracer.enabled&&Tracer.P("TemplateBinder","bindChildNodes",slice.call(arguments)),e="TEMPLATE"===t.nodeName?t.content.firstChild:t.firstChild;null!=e;)switch(e.nodeType){case 1:n=e.nextSibling,this.V(this.manifest,e),e=n;break;case 3:e=this.rt(e).nextSibling;break;case 4:case 7:case 8:case 10:e=e.nextSibling;break;case 9:case 11:e=e.firstChild}Tracer.enabled&&Tracer.I()}rt(t){Tracer.enabled&&Tracer.P("TemplateBinder","bindText",slice.call(arguments));const e=this.$.parse(t.wholeText,2048);if(null!=e){const n=new TextSymbol(this.dom,t,e);this.manifest.childNodes.push(n),processInterpolationText(n)}for(;null!=t.nextSibling&&3===t.nextSibling.nodeType;)t=t.nextSibling;return Tracer.enabled&&Tracer.I(),t}it(t,e){let n;Tracer.enabled&&Tracer.P("TemplateBinder","declareTemplateController",slice.call(arguments));const i=this.L.Y(t);if(null==i&&e.st)n=new TemplateControllerSymbol(this.dom,t,e,this.N),this.N=null,this.at(n,e,t.Z);else{n=new TemplateControllerSymbol(this.dom,t,e,this.N);const r=this.$.parse(t.Z,null==i?2048:i.o);n.et.push(new BindingSymbol(i,e.bindable,r,t.Z,t.target)),this.N=null}return Tracer.enabled&&Tracer.I(),n}j(t,e){Tracer.enabled&&Tracer.P("TemplateBinder","bindCustomAttribute",slice.call(arguments));const n=this.L.Y(t);let i;if(null==n&&e.st)i=new CustomAttributeSymbol(t,e),this.at(i,e,t.Z);else{i=new CustomAttributeSymbol(t,e);const r=this.$.parse(t.Z,null==n?2048:n.o);i.et.push(new BindingSymbol(n,e.bindable,r,t.Z,t.target))}this.manifest.attributes.push(i),this.manifest.X=1,Tracer.enabled&&Tracer.I()}at(t,e,value){Tracer.enabled&&Tracer.P("TemplateBinder","bindMultiAttribute",slice.call(arguments));const n=parseMultiAttributeBinding(value);let i;for(let r=0,s=n.length;s>r;++r){const s=this.v.parse((i=n[r]).name,i.value),a=this.L.Y(s),l=this.$.parse(s.Z,null==a?2048:a.o);let bindable=e.bindables[s.target];void 0===bindable&&(bindable=e.bindables[s.target]=new BindableInfo(s.target,BindingMode.tt)),t.et.push(new BindingSymbol(a,bindable,l,s.Z,s.target))}Tracer.enabled&&Tracer.I()}q(t,e){if(Tracer.enabled&&Tracer.P("TemplateBinder","bindPlainAttribute",slice.call(arguments)),0===t.Z.length)return void(Tracer.enabled&&Tracer.I());const n=this.L.Y(t),i=this.manifest,r=this.$.parse(t.Z,null==n?2048:n.o);if(16&i.flags){const bindable=i.bindables[t.target];null!=bindable?(i.et.push(new BindingSymbol(n,bindable,r,t.Z,t.target)),i.X=1):null==r&&"ref"!==t.target||(i.attributes.push(new PlainAttributeSymbol(t,n,r)),i.X=1)}else null!=r||"ref"===t.target?(i.attributes.push(new PlainAttributeSymbol(t,n,r)),i.X=1):i===this.k&&i.attributes.push(new PlainAttributeSymbol(t,n,r));null==n&&null!=r&&(e.value=""),Tracer.enabled&&Tracer.I()}nt(t){Tracer.enabled&&Tracer.P("TemplateBinder","declareReplacePart",slice.call(arguments));const name=t.getAttribute("replace-part");if(null==name)return Tracer.enabled&&Tracer.I(),null;t.removeAttribute("replace-part");const e=new ReplacePartSymbol(name);return this.J(t),Tracer.enabled&&Tracer.I(),e}}class ParserState{constructor(t){this.input=t,this.index=0,this.length=t.length}}const fromCharCode=String.fromCharCode;var Char;(function(Char){Char[Char.lt=34]="DoubleQuote",Char[Char.ot=39]="SingleQuote",Char[Char.ct=47]="Slash",Char[Char.ut=59]="Semicolon",Char[Char.dt=58]="Colon"})(Char||(Char={}));const ITemplateElementFactory=DI.ht("ITemplateElementFactory").gt(),{P:enter$1,I:leave$1}=Profiler.R("TemplateElementFactory"),markupCache={};class HTMLTemplateElementFactory{constructor(dom){this.dom=dom,this.template=dom.i()}static register(t){return Registration.singleton(ITemplateElementFactory,this).register(t)}i(t){if(Profiler.enabled&&enter$1(),"string"==typeof t){let e=markupCache[t];if(void 0===e){const template=this.template;template.innerHTML=t;const n=template.content.firstElementChild;null==n||"TEMPLATE"!==n.nodeName||null!=n.nextElementSibling?(this.template=this.dom.i(),e=template):(template.content.removeChild(n),e=n),markupCache[t]=e}return Profiler.enabled&&leave$1(),e.cloneNode(1)}if("TEMPLATE"!==t.nodeName){const template=this.dom.i();return template.content.appendChild(t),Profiler.enabled&&leave$1(),template}return null!=t.parentNode&&t.parentNode.removeChild(t),Profiler.enabled&&leave$1(),t}}HTMLTemplateElementFactory.inject=[IDOM];const buildNotRequired=Object.freeze({required:0,compiler:"default"}),{P:enter$2,I:leave$2}=Profiler.R("TemplateCompiler");class TemplateCompiler{constructor(t,e,n){this.Tt=t,this.v=e,this.$=n,this.pt=null,this.parts=null}get name(){return"default"}static register(t){return Registration.singleton(ITemplateCompiler,this).register(t)}compile(dom,t,e){Profiler.enabled&&enter$2();const n=new TemplateBinder(dom,new ResourceModel(e),this.v,this.$),template=t.template=this.Tt.i(t.template),i=n.bind(template);void 0!==t.instructions&&t.instructions!==PLATFORM.bt||(t.instructions=[]),1==i.hasSlots&&(t.hasSlots=1),this.pt=t.instructions,this.parts={};const r=i.attributes,s=r.length;if(s>0){let surrogates;void 0!==t.surrogates&&t.surrogates!==PLATFORM.bt||(t.surrogates=Array(s)),surrogates=t.surrogates;for(let t=0;s>t;++t)surrogates[t]=this.ft(r[t])}return this.Ct(i),this.pt=null,this.parts=null,t.build=buildNotRequired,Profiler.enabled&&leave$2(),t}Ct(t){if(8192&t.flags){const{childNodes}=t;let e;const n=childNodes.length;for(let t=0;n>t;++t)if(128&(e=childNodes[t]).flags)this.pt.push([new TextBindingInstruction(e.Bt)]);else if(32&e.flags){const t=e.et,instructions=[];let n;const i=t.length;for(let e=0;i>e;++e)instructions[e]=new LetBindingInstruction((n=t[e]).u,n.target);this.pt.push([new LetElementInstruction(instructions,e.toViewModel)])}else this.yt(e)}}At(t){const e=this.Pt(t,1);e[0]=new HydrateElementInstruction(t.res,this.It(t),this.Rt(t)),this.pt.push(e),this.Ct(t)}St(t){const e=this.Pt(t,0);e.length>0&&this.pt.push(e),this.Ct(t)}yt(t){switch(511&t.flags){case 16:this.At(t);break;case 64:this.St(t);break;case 1:this.wt(t)}}wt(t){const e=this.It(t),n=this.pt,i=this.pt=[];this.yt(t.template),this.pt=n;const def={name:null==t.N?t.res:t.N,template:t.t,instructions:i,build:buildNotRequired};let parts=void 0;if((16384&t.flags)>0){parts={};for(const e of t.parts)parts[e.name]=this.parts[e.name]}this.pt.push([new HydrateTemplateController(def,t.res,e,"else"===t.res,parts)])}It(t){let e;if(4096&t.flags){const{et:n}=t,i=n.length;e=Array(i);let r=0;for(;i>r;++r)e[r]=this.Et(n[r])}else e=PLATFORM.bt;return e}Et(t){return null==t.command?null==t.u?new SetPropertyInstruction(t.Z,t.bindable.Dt):new InterpolationInstruction(t.u,t.bindable.Dt):t.command.compile(t)}Pt(t,e){let n;if(2048&t.flags){const{attributes:i}=t,r=i.length;n=Array(e+r);for(let t=0;r>t;++t)n[t+e]=this.ft(i[t])}else n=e>0?Array(e):PLATFORM.bt;return n}Mt(t){const e=this.It(t);return new HydrateAttributeInstruction(t.res,e)}Lt(t){return null==t.command?null==t.u?new SetAttributeInstruction(t.l.Z,t.l.target):new InterpolationInstruction(t.u,t.l.target):t.command.compile(t)}ft(t){return"ref"===t.l.target?new RefBindingInstruction(t.l.Z):4&t.flags?this.Mt(t):this.Lt(t)}Rt(t){let parts;if(16384&t.flags){parts={};const e=t.parts,n=e.length;let i,r,s;for(let t=0;n>t;++t)s=e[t],i=this.pt,r=this.pt=[],this.yt(s.template),this.parts[s.name]=parts[s.name]={name:s.name,template:s.t,instructions:r,build:buildNotRequired},this.pt=i}else parts=PLATFORM.vt;return parts}}TemplateCompiler.inject=[ITemplateElementFactory,IAttributeParser,IExpressionParser];const ITemplateCompilerRegistration=TemplateCompiler,ITemplateElementFactoryRegistration=HTMLTemplateElementFactory,DefaultComponents=[TemplateCompiler,HTMLTemplateElementFactory],JitAttrBindingSyntax=[StyleAttributePattern,ClassAttributePattern,AttrAttributePattern],TriggerBindingCommandRegistration=TriggerBindingCommand,DelegateBindingCommandRegistration=DelegateBindingCommand,CaptureBindingCommandRegistration=CaptureBindingCommand,AttrBindingCommandRegistration=AttrBindingCommand,ClassBindingCommandRegistration=ClassBindingCommand,StyleBindingCommandRegistration=StyleBindingCommand,DefaultBindingLanguage=[TriggerBindingCommand,DelegateBindingCommand,CaptureBindingCommand,ClassBindingCommand,StyleBindingCommand,AttrBindingCommand],BasicConfiguration={register:t=>BasicConfiguration$1.register(t).register(...DefaultComponents$1,...DefaultBindingSyntax,...JitAttrBindingSyntax,...DefaultBindingLanguage$1,...DefaultComponents,...DefaultBindingLanguage),$t(){return this.register(DI.$t())}};export{AttrBindingCommand,AttrBindingCommandRegistration,BasicConfiguration,CaptureBindingCommand,CaptureBindingCommandRegistration,ClassBindingCommand,ClassBindingCommandRegistration,DefaultBindingLanguage,DefaultComponents,DelegateBindingCommand,DelegateBindingCommandRegistration,ITemplateCompilerRegistration,ITemplateElementFactory,ITemplateElementFactoryRegistration,StyleBindingCommand,StyleBindingCommandRegistration,TemplateBinder,TriggerBindingCommand,TriggerBindingCommandRegistration,stringifyDOM,stringifyInstructions,stringifyTemplateDefinition};
