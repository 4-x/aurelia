this.au=this.au||{},this.au.router=(function(t,kernel,runtime){"use strict";function s(t){const s={},i=[];if(!t||!t.length)return{t:s,list:i};const h=t.replace("+"," ").split("&");for(const t of h){const h=t.split("="),e=decodeURIComponent(h.shift());if(!h.length){i.push(e);continue}const value=decodeURIComponent(h.shift());s[e]=value}return{t:s,list:i}}function i(t,i,h){const e=s(i),n=s(t),r=Object.assign({},e.t,n.t),o=[...e.list,...n.list];if(o.length&&h&&h.length)for(const t of h)r[t]=o.shift();let l;return o.length&&Object.keys(r).length&&(r["s"]=o.splice(0,o.length)),{i:r,h:o,o:l=o.length?o:r}}function h(t,s,i,h){var e,n,r=arguments.length,o=3>r?s:null===h?h=Object.getOwnPropertyDescriptor(s,i):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,h);else for(n=t.length-1;n>=0;n--)(e=t[n])&&(o=(3>r?e(o):r>3?e(s,i,o):e(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}var e,n;class r{constructor(){this.l=(async t=>this.u(this,"popstate",[t])),this.window=window,this.history=window.history,this.p=[],this.v=0,this.m=null,this.g=null,this.$=null,this.C=null}P(t){if(this.v)throw kernel.Reporter.error(2003);this.v=1,this.g=t,kernel.PLATFORM.S.add(this.V,this),this.window.addEventListener("popstate",this.l)}O(){this.window.removeEventListener("popstate",this.l),kernel.PLATFORM.S.remove(this.V,this),this.g=null,this.v=0}get length(){return this.history.length}get state(){return this.history.state}get k(){return this.history.k}async go(t,s=0){if(!s)return this.u(this,"_go",[t],1);const i=this.u(this,"suppressPopstate",[],1);return this.u(this.history,"go",[t]).catch(t=>{throw t}),i}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){return this.u(this.history,"pushState",[t,s,i])}async replaceState(t,s,i){return this.u(this.history,"replaceState",[t,s,i])}async R(t){if(this.C){const t=this.C;this.C=null,t()}else{if(this.$){const t=this.$;this.$=null,t(),await Promise.resolve()}this.g(t)}}I(t,s){this.$=s,this.history.go(t)}j(t){this.C=t}u(t,s,i,h=0){let e;const n=new Promise(t=>{e=t});return h&&(i.push(e),e=null),this.p.push({target:t,H:s,t:i,resolve:e}),n}async V(t){if(!this.p.length||null!==this.m)return;this.m=this.p.shift();const s=this.m.target[this.m.H];kernel.Reporter.write(1e4,"DEQUEUE",this.m.H,this.m.t),s.apply(this.m.target,this.m.t);const i=this.m.resolve;this.m=null,i&&i()}}class o{constructor(){this.A=(async()=>{const t=this.N(),s=this.T();kernel.Reporter.write(1e4,"path changed to",t,this.q,this.U);const i={};let h,e=this.L("HistoryEntry");if(this.q&&this.q.path===t){i.D=1;const t=this._?this.U.index:this.history.length-this.J;h=this.U,this.U=this.q,this.U.index=t,this._?(this.B=0,this.F[this.U.index]=this.U,this.G?(i.M=1,this.G=0):i.W=1,this._=0):(this.B=1,this.F=this.F.slice(0,this.U.index),this.F.push(this.U)),await this.K({X:this.F,Y:this.J,Z:this.U})}else this.F=this.F||this.L("HistoryEntries")||[],this.J=this.J||this.L("HistoryOffset")||0,e||this.U?e?this.U?e.index>this.U.index?i.tt=1:this.U.index>e.index&&(i.st=1):i.M=1:i.D=1:(i.D=1,i.it=1,this.J=this.history.length),e||(e={path:t,ht:null,index:this.history.length-this.J,et:s},i.it&&(e.nt=1),this.F=this.F.slice(0,e.index),this.F.push(e),await this.K({X:this.F,Y:this.J,Z:e})),this.B=this.U?e.index-this.U.index:0,h=this.U,this.U=e;this.q=null,kernel.Reporter.write(1e4,"navigated",this.L("HistoryEntry"),this.F,this.L("HistoryOffset")),this.g(this.U,i,h)}),this.location=window.location,this.history=new r,this.U=null,this.F=null,this.J=null,this.rt=null,this.q=null,this.options=null,this.v=0,this.B=null,this._=0,this.G=0}P(t){if(this.v)throw kernel.Reporter.error(0);return this.v=1,this.options=Object.assign({},t),this.history.P(this.A),Promise.resolve().then(()=>{this.ot(this.N(),1).catch(t=>{throw t})})}O(){this.history.O(),this.v=0}lt(t,s,i){return this.q={path:t,ht:null,title:s,data:i},this.ot(t)}replace(t,s,i){return this._=1,this.q={path:t,ht:null,title:s,data:i},this.ot(t,1)}async refresh(){if(this.U)return this.G=1,this.replace(this.U.path,this.U.title,this.U.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){const t=this.B;return t?(this.B=0,this.history.go(-t,1)):this.replace(this.rt.path,this.rt.title,this.rt.data)}async pop(){await this.history.go(-1,1);const t=""+this.location,s=this.history.state;if(!s.Z.nt)return await this.history.go(-1,1),this.history.pushState(s,null,t)}async K(t,value){const{pathname:s,search:i,hash:h}=this.location;let e=Object.assign({},this.history.state);return"string"==typeof t?e[t]=JSON.parse(JSON.stringify(value)):e=Object.assign({},e,JSON.parse(JSON.stringify(t))),this.history.replaceState(e,null,`${s}${i}${h}`)}L(t){return Object.assign({},this.history.state)[t]}at(t){return this.U.title=t,this.F[this.U.index]=this.U,this.K({X:this.F,Z:this.U})}ct(t,s,i){if(i.index!==this.U.index)return;const h=`#${t}`,{pathname:e,search:n,hash:r}=this.location;if(h===r&&this.U.path===t&&this.U.ht===s)return;this.U.path=t,this.U.ht=s;const o=Object.assign({},this.history.state,{Z:this.U,X:this.F});return this.history.replaceState(o,null,`${e}${n}${h}`)}ut(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get ft(){return this.F?this.F.slice(0,this.U.index+1).map(value=>value.title):[]}N(){return this.location.hash.substring(1).split("?")[0]}async ot(t,s=0){const{pathname:i,search:h}=this.location,e=`#${t}`;return s?(this.rt=this.U,await this.history.replaceState({},null,`${i}${h}${e}`)):await this.history.pushState({},null,`${i}${h}${e}`),this.A()}T(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}g(t,s,i){const h=Object.assign({},t,s);h.pt=i,kernel.Reporter.write(1e4,"callback",t,s),this.options.g&&this.options.g(h)}}class l{constructor(){this.v=0,this.wt=(t=>{const s=l.dt(t);s.vt&&(t.preventDefault(),this.options.g(s))}),this.document=document}static dt(t){const s={vt:0,href:null,anchor:null},i=l.gt(t.target);if(!i||!l.yt(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const h=i.getAttribute("href");return s.anchor=i,s.href=h,s.vt=1===t.which,s}static gt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static yt(t){const s=t.getAttribute("target");return!s||s===l.window.name||"_self"===s}P(t){if(this.v)throw kernel.Reporter.error(2004);this.v=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.wt,1)}O(){this.document.removeEventListener("click",this.wt,1),this.v=0}}class a{constructor(component,t,s,i=0,h=null){this.component=null,this.bt=null,this.viewport=null,this.$t=null,this.Ct=null,this.t=null,this.Et=null,this.Pt(component),this.St(t),this.Vt(s),this.Ot=i,this.kt=h}Pt(component){"string"==typeof component?(this.bt=component,this.component=null):(this.component=component,this.bt=component.description.name)}St(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.$t=t,this.viewport=null):(this.viewport=t,null!==t&&(this.$t=t.name))}Vt(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.Ct=t,this.t={id:t}):this.t=t}Rt(t){if(null!==this.component)return this.component;const s=t.get(kernel.IContainer),i=s.It(runtime.CustomElementResource.jt(this.bt));return null!==i?i.At(s).Ht:null}Nt(router){return null!==this.viewport?this.viewport:router.Tt()[this.$t]}xt(t,s=0,i=0){return s&&this.Ct!==t.Ct?0:i?this.component===t.component:this.bt===t.bt}}class c{constructor(t,s){this.active="",this.qt=t,Object.assign(this,{title:s.title,children:null,Ut:s.Ut,active:""}),this.instructions=this.Lt(s.Dt),this.link=this._t(this.instructions),this.zt=s.Jt?this._t(this.Lt(s.Jt)):this.link,this.Bt=this.qt.router.Ft.get(runtime.IObserverLocator),this.Gt=this.Bt.Mt(0,this.qt.router,"activeComponents"),this.Gt.subscribe(this)}get Qt(){return this.children&&this.children.length?"nav-has-children":""}Wt(){this.active=this.link&&this.link.length?this.Kt():"nav-active"===this.active?"nav-active":this.Xt()?"nav-active-child":""}Kt(){const t=this.qt.router.Zt.Yt(this.zt),s=this.qt.router.ts.map(t=>this.qt.router.Zt.ss(t));for(const component of t)if(!s.find(t=>t.xt(component)))return"";return"nav-active"}hs(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}_t(instructions){return this.qt.router.Zt.es(instructions)}Lt(t){if(!Array.isArray(t))return this.Lt([t]);const instructions=[];for(const s of t)instructions.push("string"==typeof s?this.qt.router.Zt.ss(s):s instanceof a?s:s.component?new a(s.component,s.viewport,s.t):new a(s));return instructions}Xt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Xt())return 1;return 0}}class u{constructor(router,name,t=[]){this.router=router,this.name=name,this.ns=t}rs(t){for(const s of t)this.os(this.ns,s)}os(t,s){const i=new c(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.os(i.children,t)}}}class f{constructor(t,s){this.wt=t,this.names=s}}class p{constructor(t,s){this.ls=t,this.as=s}}class w{constructor(){this.cs=0,this.us=0,this.fs=0}}class d{constructor(t,s,i){this.wt=t,this.ps=s,this.ws=i}}class v{constructor(t,s,i){this.ds=t,this.vs=s,this.repeat=i}ms(t){return this.vs===t.vs&&this.ds===t.ds}}class State{constructor(t){this.gs=t,this.ys=[]}put(t){let s=this.ys.find(s=>s.gs.ms(t));return void 0===s&&(s=new State(t),this.ys.push(s),t.repeat&&s.ys.push(s)),s}}const m=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;class g{constructor(t,s){this.name=t,this.bs=t,this.$s=s,this.optional=0}Cs(t){const s=this.bs,i=s.length;let h=0,e="";if(this.$s)for(;i>h;++h)e=s.charAt(h),t(new v(null,e,0));else for(;i>h;++h)e=s.charAt(h),t(new v(null,e.toUpperCase()+e.toLowerCase(),0))}Es(){return this.bs.replace(m,"\\$1")}Ps(t,s){return this.bs}}class y{constructor(name,optional){this.name=name,this.optional=optional}Cs(t){t(new v("/",null,1))}Es(){return"([^/]+)"}Ps(t,s){return s[this.name]=1,t[this.name]}}class b{constructor(name){this.name=name,this.optional=0}Cs(t){t(new v("",null,1))}Es(){return"(.+)"}Ps(t,s){return s[this.name]=1,t[this.name]}}class ${Cs(t){}Es(){return""}Ps(t,s){return""}}class C{P(t){this.Ss=Object.assign({viewport:"@",Vs:"+",scope:"/",Ot:"!",t:"(",Os:")",ks:"&",add:"+",clear:"-",action:"."},t.Ss)}get Rs(){return this.Ss.clear}Yt(instructions){return null===instructions||""===instructions?[]:(instructions.startsWith("/")&&(instructions=instructions.slice(1)),instructions.split(this.Ss.Vs).map(t=>this.ss(t)))}ss(t){const instructions=t.split(this.Ss.scope).map(t=>this.Is(t));for(let t=0;instructions.length-1>t;t++)instructions[t].kt=instructions[t+1];return instructions[0]}es(instructions){return instructions.map(t=>this.js(t)).join(this.Ss.Vs)}js(t,s=0){if("string"==typeof t)return this.Hs(t,s);{const instructions=[t];for(;t=t.kt;)instructions.push(t);return instructions.map(t=>this.Hs(t,s)).join(this.Ss.scope)}}As(t){return t.split(this.Ss.scope).map(t=>this.ss(t))}Ns(instructions){return Array.isArray(instructions)?instructions.map(t=>this.js(t)).join(this.Ss.scope):this.Ns([instructions])}Ts(t,s){return t&&(s=`/${t}${this.Ss.scope}${s}`),s}xs(t){return{qs:t===this.Ss.clear||t.startsWith(this.Ss.clear+this.Ss.add),Us:t.startsWith(this.Ss.clear)?t.slice(2):t}}Ls(t){let s=t.slice().sort((t,s)=>s.split(this.Ss.scope).length-t.split(this.Ss.scope).length),i=[];if((s=s.map(value=>`${this.Ss.scope}${value}${this.Ss.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.Ss.scope).length-s.split(this.Ss.scope).length),i}Ds(t,s=0){const i=t.slice();return s&&i.unshift(this.Rs),i.join(this.Ss.Vs)}Is(t){let component,s,i,h;const[e,n]=t.split(this.Ss.viewport);void 0===n?([component,...i]=e.split(this.Ss.t),component.endsWith(this.Ss.Ot)&&(h=1,component=component.slice(0,-this.Ss.Ot.length))):(component=e,[s,...i]=n.split(this.Ss.t),s.endsWith(this.Ss.Ot)&&(h=1,s=s.slice(0,-this.Ss.Ot.length)));let r=i.length?i.join(this.Ss.t):void 0;return this.Ss.Os.length&&r&&r.endsWith(this.Ss.Os)&&(r=r.slice(0,-this.Ss.Os.length)),new a(component,s,r,h)}Hs(t,s=0){if("string"==typeof t)return this.js(this.ss(t),s);{let i=t.bt;return null===t.$t||s||(i+=this.Ss.viewport+t.$t),t.Ct&&(i+=this.Ss.t+t.Ct+this.Ss.Os),i}}}class E{constructor(){this._s=(t=>t),this.zs=(instructions=>instructions)}}(function(t){t[t.Js=0]="none",t[t.Bs=1]="created",t[t.loaded=2]="loaded",t[t.Fs=3]="initialized",t[t.Gs=4]="added"})(e||(e={})),(function(t){t.default="default",t.Ms="disallow",t.Qs="enter",t.refresh="refresh"})(n||(n={}));class P{constructor(t=null,s=null,i=null,h=null){this.content=t,this.t=s,this.Ws=i,this.component=null,this.Ks=0,this.Xs=0,this.Ys=0,this.Zs=0,null!==this.content&&"string"==typeof this.content&&null!==h&&(this.content=this.Rt(h))}ti(t){return"string"==typeof t.content&&this.bt()===t.content||"string"!=typeof t.content&&this.content===t.content}si(t){return this.t===t.t&&this.Ws.et===t.Ws.et}ii(){return"reentryBehavior"in this.component?this.component.ii:"default"}hi(t){return("string"==typeof t.content&&this.bt()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.t===t.t}ei(t){0===this.Ks&&(this.Ys||(this.component=this.ni(t)),this.Ks=1)}ri(){1===this.Ks&&(this.Ks=0)}oi(t,s){if(!this.component)return Promise.resolve(0);if(!this.component.oi)return Promise.resolve(1);const h=i(this.t,this.Ws.et,this.content.t);this.Ws.t=h.i,this.Ws.h=h.h;const e=this.component.oi(h.o,this.Ws,s);return kernel.Reporter.write(1e4,"viewport canEnter",e),"boolean"==typeof e?Promise.resolve(e):"string"==typeof e?Promise.resolve([new a(e,t)]):e}li(t){if(!this.component||!this.component.li)return Promise.resolve(1);const s=this.component.li(this.Ws,t);return kernel.Reporter.write(1e4,"viewport canLeave",s),"boolean"==typeof s?Promise.resolve(s):s}async Qs(t){if(this.Zs||1===this.Ks&&!this.Xs){if(this.component.Qs){const s=i(this.t,this.Ws.et,this.content.t);this.Ws.t=s.i,this.Ws.h=s.h,await this.component.Qs(s.o,this.Ws,t)}this.Xs=1}}async ai(t){4===this.Ks&&this.Xs&&(this.component.ai&&await this.component.ai(this.Ws,t),this.Xs=0)}loadComponent(t,s){if(1===this.Ks&&this.Xs)return this.Ys||this.component.ci(0,t,s),this.Ks=2,Promise.resolve()}ui(){2===this.Ks&&(this.Ks=1)}fi(){2===this.Ks&&(this.Ys||this.component.pi(2560,null),this.Ks=3)}wi(t=0){3===this.Ks&&(t||(this.component.di(5120),this.Ks=2))}addComponent(t){if(3===this.Ks){if(this.component.vi(512),this.Ys){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.Ks=4}}mi(t,s=0){if(4===this.Ks&&!this.Xs){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.gi(1024),this.Ks=3}}async yi(t,s,i=0){switch(this.Ks){case 4:await this.ai(s),this.mi(t,i);case 3:this.wi(i);case 2:this.ui();case 1:this.ri()}}bt(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}Rt(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(kernel.IContainer),i=s.It(runtime.CustomElementResource.jt(this.content));return null!==i?i.At(s).Ht:null}}ni(t){if(null===this.content)return null;const component=this.bt();return t.get(kernel.IContainer).get("string"!=typeof component?component:runtime.CustomElementResource.jt(component))}}class S{constructor(router,name,t,s,i,h,e){this.router=router,this.name=name,this.bi=t,this.context=s,this.$i=i,this.scope=h,this.options=e,this.clear=0,this.content=new P,this.Ci=null,this.Ei=null,this.Pi=null,this.cache=[],this.enabled=1}Si(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.Zt.Rs)this.clear=1,t=null;else{const s=this.router.Zt.ss(t);t=s.bt,i=s.Ct}if(this.Ci=new P(t,i,s,this.context),this.options.Vi){const t=this.cache.find(t=>this.Ci.hi(t));t?(this.Ci=t,this.Ci.Ys=1):this.cache.push(this.Ci)}return!this.content.ti(this.Ci)||s.M||"refresh"===this.content.ii()?1:"disallow"!==this.content.ii()?this.content.si(this.Ci)&&"enter"!==this.content.ii()?0:(this.content.Zs=1,this.Ci.content=this.content.content,this.Ci.component=this.content.component,this.Ci.Ks=this.content.Ks,this.Ci.Zs=this.content.Zs,1):void 0}Oi(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.bi&&(this.scope.bi=t),this.bi!==t&&(this.Pi=Object.assign({},this),this.ki(),this.bi=t,i&&i.Ri&&(this.options.Ri=i.Ri),i&&i.default&&(this.options.default=i.default),i&&i.Ii&&(this.options.Ii=i.Ii),i&&i.ji&&(this.options.ji=i.ji),i&&i.Vi&&(this.options.Vi=i.Vi),this.Ei&&this.Ei()),s&&(s.$t=this.name),this.context!==s&&(this.context=s),this.content.component||this.Ci&&this.Ci.component||!this.options.default||this.router.Hi(this.options.default,this)}remove(t,s){return this.bi===t&&this.context===s?(this.content.component&&this.content.yi(this.bi,this.Ci?this.Ci.Ws:null,this.options.Vi).catch(t=>{throw t}),1):0}async li(){return this.content.li(this.Ci.Ws)}async oi(){return this.clear?1:this.Ci.content?(await this.Ai(),this.Ci.ei(this.context),this.Ci.oi(this,this.content.Ws)):0}async Qs(){return kernel.Reporter.write(1e4,"Viewport enter",this.name),this.clear?1:this.Ci&&this.Ci.component?(await this.Ci.Qs(this.content.Ws),await this.Ci.loadComponent(this.context,this.bi),this.Ci.fi(),1):0}async Ni(){return kernel.Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&!this.Ci.component&&(await this.content.ai(this.Ci.Ws),this.content.mi(this.bi,this.options.Vi),this.content.wi(this.options.Vi),this.content.ui(),this.content.ri()),this.Ci.component&&(this.Ci.addComponent(this.bi),this.content.component&&(await this.content.ai(this.Ci.Ws),this.content.Zs||(this.content.mi(this.bi,this.options.Vi),this.content.wi(this.options.Vi),this.content.ui(),this.content.ri())),this.content=this.Ci,this.content.Zs=0),this.clear&&(this.content=new P(null,null,this.Ci.Ws)),this.Ci=null,1}Ti(){this.Pi=null}async xi(){await this.Ci.yi(this.bi,this.Ci?this.Ci.Ws:null,this.options.Vi),this.Pi&&Object.assign(this,this.Pi)}description(t=0){if(this.content.content){const component=this.content.bt();if(t||this.scope||this.options.qi)return this.router.Zt.js(new a(component,this,this.content.t,null!==this.scope));const s=this.$i.Ui([new a(component)]);return this.router.Zt.js(new a(component,s&&s.Li&&s.Li.length?null:this,this.content.t))}}Di(t=0){const s=[this.$i._i(t),this.description(t)];return this.router.Zt.Ns(s.filter(value=>value&&value.length))}zi(component){let t=this.options.Ri||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}Ji(component){if("-"===component||null===component)return 1;let t=this.options.Ri;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}Bi(t){this.content.component&&this.content.fi()}Fi(t){kernel.Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.Ci),this.enabled=1,this.content.component&&this.content.addComponent(this.bi)}Gi(t){kernel.Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.mi(this.bi,this.options.Vi),this.enabled=0}Mi(t){this.content.component&&this.content.wi(this.options.Vi)}ki(){this.options={},this.content=new P,this.cache=[]}async Ai(){return this.bi?Promise.resolve():new Promise(t=>{this.Ei=t})}}class Scope{constructor(router,t,s,i){this.router=router,this.bi=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.Qi=[],this.Wi=null,this.parent&&this.parent.Ki(this)}Xi(){return this.Qi.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}Ui(t){const instructions=[];let s=0;t?(this.Wi={},this.Li=t.slice()):this.Li||(this.Li=[]),this.Wi=Object.assign({},this.Xi(),this.Wi);for(let t=0;this.Li.length>t;t++){const i=this.Li[t];for(const name in this.Wi){const h=this.Wi[name];if(h&&h.zi(i.bt)){const e=this.Yi(i,h);instructions.push(...e.Li),s=s||e.Zi,this.Wi[name]=null,this.Li.splice(t--,1);break}}}for(let t=0;this.Li.length>t;t++){const i=this.Li[t],name=i.$t;if(!name||!name.length)continue;const h=i.Ot;this.Xi()[name]||(this.th(name,null,null,{scope:h,qi:1}),this.Wi[name]=this.Xi()[name]);const e=this.Wi[name];if(e&&e.Ji(i.bt)){const h=this.Yi(i,e);instructions.push(...h.Li),s=s||h.Zi,this.Wi[name]=null,this.Li.splice(t--,1)}}for(let t=0;this.Li.length>t;t++){const i=this.Li[t],h=[];for(const name in this.Wi){const t=this.Wi[name];t&&t.Ji(i.bt)&&h.push(t)}if(1===h.length){const e=h.shift(),n=this.Yi(i,e);instructions.push(...n.Li),s=s||n.Zi,this.Wi[e.name]=null,this.Li.splice(t,1);break}}if(s=s||this.Li.length>0,!t)for(const t of this.children){const i=t.Ui();instructions.push(...i.Li),s=s||i.Zi}return{Li:instructions,Zi:s}}Yi(t,s){t.St(s);const instructions=[t];let i=0;if(t.kt){const h=(s.scope||s.$i).Ui([t.kt]);instructions.push(...h.Li),i=i||h.Zi}return{Li:instructions,Zi:i}}th(name,t,s,i){let h=this.Xi()[name];if(t&&h&&null!==h.bi&&h.bi!==t&&(h.enabled=0,(h=this.Qi.find(s=>s.name===name&&s.bi===t))&&(h.enabled=1)),!h){let e;i.scope&&(e=new Scope(this.router,t,s,this),this.router.sh.push(e)),h=new S(this.router,name,null,null,this,e,i),this.Qi.push(h)}return(t||s)&&h.Oi(t,s,i),h}ih(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.hh(t.scope),this.Qi.splice(this.Qi.indexOf(t),1)),Object.keys(this.Qi).length}hh(){for(const t of this.children)t.hh();const t=this.Xi();for(const name in t)this.router.ih(t[name],null,null)}Ki(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}eh(t=0,s=0){const i=[];for(const h in this.Xi()){const e=this.Xi()[h];(e.options.ji||e.options.Ii&&!t)&&!s||i.push(e.Di(t))}for(const s of this.children)i.push(...s.eh(t));return i.filter(value=>value&&value.length)}Tt(){const t=this.Qi.filter(t=>t.enabled);for(const s of this.children)t.push(...s.Tt());return t}_i(t=0){if(!this.bi||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.nh(this.context.get(kernel.IContainer).parent);for(;i&&i.$i===this.parent;)s.unshift(i.description(t)),i=this.nh(i.context.get(kernel.IContainer).parent);return s.unshift(this.parent._i(t)),this.router.Zt.Ns(s.filter(value=>value&&value.length))}nh(t){const s=Object.values(this.Xi());for(;t;){const i=s.find(s=>s.context.get(kernel.IContainer)===t);if(i)return i;t=t.parent}return null}}const V=kernel.DI.oh("IRouteTransformer").rh(t=>t.singleton(E)),O=kernel.DI.oh("IRouter").rh(t=>t.singleton(k));class k{constructor(t,s){this.Ft=t,this.sh=[],this.lh={},this.ts=[],this.ah=[],this.v=0,this.uh=[],this.fh=null,this.ph=null,this.wh=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.dh(t.anchor)._i();s=this.Zt.Ts(i,s)}this.vh.ut(s)}),this.vh=new o,this.mh=new l,this.Zt=new C,this.gh=s}get yh(){return null!==this.fh}P(t){if(this.v)throw kernel.Reporter.error(2001);return this.v=1,this.options=Object.assign({g:t=>{this.bh(t)},_s:this.gh._s,zs:this.gh.zs},t),this.Zt.P({Ss:this.options.Ss}),this.mh.P({g:this.wh}),this.vh.P(this.options).catch(t=>{throw t})}O(){if(!this.v)throw kernel.Reporter.error(2e3);this.mh.O(),this.vh.O()}bh(t){this.uh.push(t),this.$h().catch(t=>{throw t})}async $h(){if(null!==this.fh||!this.uh.length)return Promise.resolve();const t=this.uh.shift();this.fh=t,this.options.Ch&&this.options.Ch(t);let i=0;(t.st||t.tt)&&t.ht&&(t.path=t.ht,i=1);let h=t.path;if(this.options._s&&!i){const t=this.options._s(h,this);h=Array.isArray(t)?this.Zt.es(t):t}const{qs:e,Us:n}=this.Zt.xs(h);e&&(h=n);const r=s(t.et);t.t=r.t,t.h=r.list;const o=this.Zt.Yt(h);if(!o&&!o.length&&!e)return this.fh=null,this.$h();const l=e?this.Tt().filter(value=>null!==value.content.component):[],a=this.Tt().filter(value=>value.options.default&&null===value.content.component),c=[];let{Li:u,Zi:f}=this.Eh.Ui(o),p=100;for(;u.length||f||a.length;){if(!p--)throw kernel.Reporter.error(2002);const s=[];for(const i of u){const h=i.viewport,e=this.Zt.js(i,1);h.Si(e,t)&&s.push(h);const n=l.findIndex(value=>value===h);0>n||l.splice(n,1);const r=a.findIndex(value=>value===h);0>r||a.splice(r,1)}for(const i of l)i.Si(this.Zt.Rs,t)&&s.push(i);let i;for(;i=a.shift();)i.Si(i.options.default,t)&&s.push(i);let h=await Promise.all(s.map(value=>value.li()));if(h.findIndex(value=>0==value)>=0)return this.Ph([...s,...c],t);if((h=await Promise.all(s.map(async value=>{const t=await value.oi();if("boolean"==typeof t)return t?value.Qs():0;for(const s of t)this.Hi(s);return value.xi().catch(t=>{throw t}),1}))).some(t=>0==t))return this.Ph([...s,...c],t);for(const t of s)c.find(value=>value===t)||c.push(t);const e=this.Eh.Ui();let n;for(u=[];n=this.ah.shift();)e.Li.find(value=>value.viewport===n.viewport)||u.push(n);u=[...u,...e.Li],f=e.Zi}await Promise.all(c.map(value=>value.Ni())),await this.Sh(t),t.it||t.Vh||!c.every(t=>t.options.ji)||await this.vh.pop(),c.forEach(t=>{t.Ti()}),this.ph=this.fh,this.ph.Vh&&(this.ph.Vh=0),this.fh=null,this.$h().catch(t=>{throw t})}Hi(t,s){this.fh?t instanceof a?(t.viewport||(t.viewport=this.Tt().find(s=>s.name===t.$t)),this.ah.push(t)):("string"==typeof s&&(s=this.Tt().find(t=>t.name===s)),this.ah.push(new a(t,s))):this.ph&&(this.uh.unshift({path:"",ht:"",Vh:1}),this.$h().catch(t=>{throw t}))}Oh(t){return this.kh(),this.dh(t)}Rh(name){return this.Tt().find(t=>t.name===name)}th(name,t,s,i){return kernel.Reporter.write(1e4,"Viewport added",name,t),this.Oh(t).th(name,t,s,i)}ih(t,s,i){const h=t.$i;h.ih(t,s,i)||this.hh(h)}Tt(){return this.kh(),this.Eh.Tt()}hh(t){if(t!==this.Eh){t.hh();const s=this.sh.indexOf(t);0>s||this.sh.splice(s,1)}}lt(t,s,i){if("string"==typeof t)return this.vh.lt(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.vh.replace(t,s,i)}refresh(){return this.vh.refresh()}back(){return this.vh.back()}forward(){return this.vh.forward()}Ih(name,t){const s=this.jh(name);s&&(s.ns=[]),this.Hh(name,t)}Hh(name,t){let s=this.lh[name];s||(s=this.lh[name]=new u(this,name)),s.rs(t),this.lh[name]=new u(s.router,s.name,s.ns)}jh(name){return this.lh[name]}async Ph(t,s){t.forEach(t=>{t.xi().catch(t=>{throw t})}),s.D?await this.vh.pop():await this.vh.cancel(),this.fh=null,this.$h().catch(t=>{throw t})}kh(){if(!this.Eh){const t=this.Ft.get(runtime.Aurelia).root();this.Eh=new Scope(this,t.Ah,t.$context,null),this.sh.push(this.Eh)}}dh(t){let s=t;for(;s.parentElement;){const t=this.Tt().find(t=>t.bi===s);if(t&&t.$i)return t.$i;s=s.parentElement}return this.Eh}Sh(t){this.ts=this.Eh.eh(1,1),this.ts=this.Zt.Ls(this.ts);let s=this.Eh.eh();s=this.Zt.Ls(s);let i=this.Zt.Ds(s);if(this.options.zs){const t=this.options.zs(this.Zt.Yt(i),this);i=Array.isArray(t)?this.Zt.es(t):t}let h=this.Eh.eh(1);h=this.Zt.Ls(h);const e=t.et&&t.et.length?`?${t.et}`:"";return this.vh.ct(i+e,this.Zt.Ds(h,1)+e,t)}}k.inject=[kernel.IContainer,V],t.Nh=class{constructor(router){this.router=router,this.name=null,this.ns=null,this.level=0}get Th(){const t=this.router.lh[this.name];return t?t.ns:[]}active(t){return"Active"}},h([runtime.bindable],t.Nh.prototype,"name",void 0),h([runtime.bindable],t.Nh.prototype,"routes",void 0),h([runtime.bindable],t.Nh.prototype,"level",void 0),t.Nh=h([kernel.inject(k,Element),runtime.customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],t.Nh);class R{constructor(router,t,s){this.router=router,this.bi=t,this.xh=s,this.name="default",this.scope=null,this.Ri=null,this.default=null,this.Ii=null,this.ji=null,this.Vi=null,this.viewport=null}qh(t,host,parts,s){const i=this.constructor,dom=s.get(runtime.IDOM),template=this.xh.Uh(dom,i.description,s,i);template.Lh=runtime.createRenderContext(dom,s,i.description.dependencies,i),template.qh(this,host,parts)}bound(){this.connect()}Dh(){this.disconnect()}connect(){const t={scope:this.bi.hasAttribute("scope")};this.Ri&&this.Ri.length&&(t.Ri=this.Ri),this.default&&this.default.length&&(t.default=this.default),this.bi.hasAttribute("no-link")&&(t.Ii=1),this.bi.hasAttribute("no-history")&&(t.ji=1),this.bi.hasAttribute("stateful")&&(t.Vi=1),this.viewport=this.router.th(this.name,this.bi,this.$context,t)}disconnect(){this.router.ih(this.viewport,this.bi,this.$context)}Bi(t){this.viewport&&this.viewport.Bi(t)}Fi(t){this.viewport&&this.viewport.Fi(t)}Gi(t){this.viewport&&this.viewport.Gi(t)}Mi(t){this.viewport&&this.viewport.Mi(t)}}R.inject=[k,runtime.INode,runtime.IRenderingEngine],h([runtime.bindable],R.prototype,"name",void 0),h([runtime.bindable],R.prototype,"scope",void 0),h([runtime.bindable],R.prototype,"usedBy",void 0),h([runtime.bindable],R.prototype,"default",void 0),h([runtime.bindable],R.prototype,"noLink",void 0),h([runtime.bindable],R.prototype,"noHistory",void 0),h([runtime.bindable],R.prototype,"stateful",void 0),runtime.CustomElementResource._h({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> ${scope ? "[new scope]" : ""} : <b>${viewport.content && viewport.content.componentName()}</b></div></template>'},R);const I=k,DefaultComponents=[I],j=R,H=t.Nh,DefaultResources=[R,t.Nh],A={register:t=>t.register(...DefaultComponents,...DefaultResources),zh(){return this.register(kernel.DI.zh())}};return t.Jh=v,t.DefaultComponents=DefaultComponents,t.DefaultResources=DefaultResources,t.Bh=y,t.Fh=$,t.Gh=f,t.Mh=o,t.Qh=V,t.Wh=O,t.Kh=l,t.Xh=u,t.Yh=H,t.Zh=r,t.te=d,t.se=p,t.ie=class{constructor(){this.he=new State,this.names={},this.ns=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.he;const i=[];let h="^";const e=new w,n=[],r=t.wt.name;let o=1,l=t.path;"/"===l.charAt(0)&&(l=l.slice(1));const a=[],c=l.split("/");let u,d;for(let r=0,l=c.length;l>r;++r){let l=(u=c[r]).match(/^:([^?]+)(\?)?$/);if(l){const[,name,optional]=l;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);a.push(d=new y(name,!!optional)),n.push(name),e.us++}else if(l=u.match(/^\*(.+)$/))a.push(d=new b(l[1])),n.push(l[1]),e.fs++;else{if(""===u){a.push(new $);continue}a.push(d=new g(u,t.$s)),e.cs++}const f=s.put(new v(null,"/",0));let p=f;d.Cs(t=>{p=p.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].ys.push(f);d.optional?(i.push(p),h+=`(?:/${d.Es()})?`):(s=p,h+=`/${d.Es()}`,i.length=0,o=0)}o&&(s=s.put(new v(null,"/",0)),h+="/?");const m=[new f(t.wt,n)];if(this.ns.set(t.wt,new p(a,m)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new p(a,m))}for(let s=0;i.length>s;s++){const n=i[s];n.as=m,n.Es=RegExp(`${h}$`,t.$s?"":"i"),n.types=e}return s.as=m,s.Es=RegExp(`${h}$`,t.$s?"":"i"),s.types=e,s}ee(t){return"string"==typeof t?this.names[t]:this.ns.get(t)}ne(t){const s=this.ee(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.as]}re(t){return!!this.ee(t)}Ps(t,s){const i=this.ee(t);if(!i)throw Error(`There is no route named ${t}`);const h=i.as[0].wt;if(h.oe)return h.href;const e=Object.assign({},s),n=i.ls,r={};let o="";for(let s=0,i=n.length;i>s;s++){const i=n[s];if(i instanceof $)continue;const h=i.Ps(e,r);if(null==h){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=h}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(e,t);const l=kernel.buildQueryString(e);return o+(l?`?${l}`:"")}le(t){let s=[this.he],i={},h=0,e=t;const n=e.indexOf("?");if(-1!==n){const t=e.slice(n+1);e=e.slice(0,n),i=kernel.parseQueryString(t)}"/"!==(e=decodeURI(e)).charAt(0)&&(e=`/${e}`);let r=e.length;r>1&&"/"===e.charAt(r-1)&&(e=e.slice(0,-1),h=1,--r);for(let t=0;r>t;++t){const i=[],h=e.charAt(t);if(s.forEach(t=>{t.ys.forEach(t=>{null!==t.gs.vs?-1!==t.gs.vs.indexOf(h)&&i.push(t):null!==t.gs.ds&&-1===t.gs.ds.indexOf(h)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].as&&o.push(s[t]);o.sort((t,s)=>{if(t.types.fs!==s.types.fs)return t.types.fs-s.types.fs;if(t.types.fs){if(t.types.cs!==s.types.cs)return s.types.cs-t.types.cs;if(t.types.us!==s.types.us)return s.types.us-t.types.us}return t.types.us!==s.types.us?t.types.us-s.types.us:t.types.cs!==s.types.cs?s.types.cs-t.types.cs:0});const l=o[0];if(l&&l.as){h&&"(.+)$"===l.Es.source.slice(-5)&&(e=`${e}/`);const t=e.match(l.Es);let s=1;const n=[];return n.ae=i,l.as.forEach(i=>{const h={};i.names.forEach(name=>{h[name]=t[s++]}),n.push(new d(i.wt,h,i.names.length>0))}),n}}},t.ce=k,t.ue=A,t.fe=I,t.Scope=Scope,t.pe=b,t.State=State,t.we=g,t.de=w,t.ve=S,t.me=R,t.ge=j,t})({},kernel,runtime);
