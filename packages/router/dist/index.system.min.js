System.register("router",["@aurelia/kernel","@aurelia/runtime"],function(t){"use strict";var Reporter,PLATFORM,IContainer,buildQueryString,parseQueryString,DI,inject,CustomElementResource,IObserverLocator,Aurelia,bindable,customElement,IDOM,createRenderContext,INode,IRenderingEngine;return{t:[function(t){Reporter=t.Reporter,PLATFORM=t.PLATFORM,IContainer=t.IContainer,buildQueryString=t.buildQueryString,parseQueryString=t.parseQueryString,DI=t.DI,inject=t.inject},function(t){CustomElementResource=t.CustomElementResource,IObserverLocator=t.IObserverLocator,Aurelia=t.Aurelia,bindable=t.bindable,customElement=t.customElement,IDOM=t.IDOM,createRenderContext=t.createRenderContext,INode=t.INode,IRenderingEngine=t.IRenderingEngine}],s(){function s(t){const s={},i=[];if(!t||!t.length)return{i:s,list:i};const h=t.replace("+"," ").split("&");for(const t of h){const h=t.split("="),e=decodeURIComponent(h.shift());if(!h.length){i.push(e);continue}const value=decodeURIComponent(h.shift());s[e]=value}return{i:s,list:i}}function i(t,i,h){const e=s(i),n=s(t),r=Object.assign({},e.i,n.i),o=[...e.list,...n.list];if(o.length&&h&&h.length)for(const t of h)r[t]=o.shift();let l;return o.length&&Object.keys(r).length&&(r["h"]=o.splice(0,o.length)),{o:r,l:o,u:l=o.length?o:r}}function h(t,s,i,h){var e,n,r=arguments.length,o=3>r?s:null===h?h=Object.getOwnPropertyDescriptor(s,i):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,h);else for(n=t.length-1;n>=0;n--)(e=t[n])&&(o=(3>r?e(o):r>3?e(s,i,o):e(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}var e,n;class r{constructor(){this.p=(async t=>this.m(this,"popstate",[t])),this.window=window,this.history=window.history,this.v=[],this.g=0,this.$=null,this.C=null,this.R=null,this.S=null}P(t){if(this.g)throw Reporter.error(2003);this.g=1,this.C=t,PLATFORM.V.add(this.O,this),this.window.addEventListener("popstate",this.p)}k(){this.window.removeEventListener("popstate",this.p),PLATFORM.V.remove(this.O,this),this.C=null,this.g=0}get length(){return this.history.length}get state(){return this.history.state}get I(){return this.history.I}async go(t,s=0){if(!s)return this.m(this,"_go",[t],1);const i=this.m(this,"suppressPopstate",[],1);return this.m(this.history,"go",[t]).catch(t=>{throw t}),i}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){return this.m(this.history,"pushState",[t,s,i])}async replaceState(t,s,i){return this.m(this.history,"replaceState",[t,s,i])}async H(t){if(this.S){const t=this.S;this.S=null,t()}else{if(this.R){const t=this.R;this.R=null,t(),await Promise.resolve()}this.C(t)}}j(t,s){this.R=s,this.history.go(t)}N(t){this.S=t}m(t,s,i,h=0){let e;const n=new Promise(t=>{e=t});return h&&(i.push(e),e=null),this.v.push({target:t,A:s,i,resolve:e}),n}async O(t){if(!this.v.length||null!==this.$)return;this.$=this.v.shift();const s=this.$.target[this.$.A];Reporter.write(1e4,"DEQUEUE",this.$.A,this.$.i),s.apply(this.$.target,this.$.i);const i=this.$.resolve;this.$=null,i&&i()}}t("QueuedBrowserHistory",r);class o{constructor(){this.T=(async()=>{const t=this.q(),s=this.D();Reporter.write(1e4,"path changed to",t,this.L,this.U);const i={};let h,e=this.B("HistoryEntry");if(this.L&&this.L.path===t){i._=1;const t=this.J?this.U.index:this.history.length-this.F;h=this.U,this.U=this.L,this.U.index=t,this.J?(this.G=0,this.M[this.U.index]=this.U,this.W?(i.K=1,this.W=0):i.X=1,this.J=0):(this.G=1,this.M=this.M.slice(0,this.U.index),this.M.push(this.U)),await this.Y({Z:this.M,tt:this.F,st:this.U})}else this.M=this.M||this.B("HistoryEntries")||[],this.F=this.F||this.B("HistoryOffset")||0,e||this.U?e?this.U?e.index>this.U.index?i.it=1:this.U.index>e.index&&(i.ht=1):i.K=1:i._=1:(i._=1,i.et=1,this.F=this.history.length),e||(e={path:t,nt:null,index:this.history.length-this.F,rt:s},i.et&&(e.ot=1),this.M=this.M.slice(0,e.index),this.M.push(e),await this.Y({Z:this.M,tt:this.F,st:e})),this.G=this.U?e.index-this.U.index:0,h=this.U,this.U=e;this.L=null,Reporter.write(1e4,"navigated",this.B("HistoryEntry"),this.M,this.B("HistoryOffset")),this.C(this.U,i,h)}),this.location=window.location,this.history=new r,this.U=null,this.M=null,this.F=null,this.lt=null,this.L=null,this.options=null,this.g=0,this.G=null,this.J=0,this.W=0}P(t){if(this.g)throw Reporter.error(0);return this.g=1,this.options=Object.assign({},t),this.history.P(this.T),Promise.resolve().then(()=>{this.at(this.q(),1).catch(t=>{throw t})})}k(){this.history.k(),this.g=0}ct(t,s,i){return this.L={path:t,nt:null,title:s,data:i},this.at(t)}replace(t,s,i){return this.J=1,this.L={path:t,nt:null,title:s,data:i},this.at(t,1)}async refresh(){if(this.U)return this.W=1,this.replace(this.U.path,this.U.title,this.U.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){const t=this.G;return t?(this.G=0,this.history.go(-t,1)):this.replace(this.lt.path,this.lt.title,this.lt.data)}async pop(){await this.history.go(-1,1);const t=""+this.location,s=this.history.state;if(!s.st.ot)return await this.history.go(-1,1),this.history.pushState(s,null,t)}async Y(t,value){const{pathname:s,search:i,hash:h}=this.location;let e=Object.assign({},this.history.state);return"string"==typeof t?e[t]=JSON.parse(JSON.stringify(value)):e=Object.assign({},e,JSON.parse(JSON.stringify(t))),this.history.replaceState(e,null,`${s}${i}${h}`)}B(t){return Object.assign({},this.history.state)[t]}ut(t){return this.U.title=t,this.M[this.U.index]=this.U,this.Y({Z:this.M,st:this.U})}ft(t,s,i){if(i.index!==this.U.index)return;const h=`#${t}`,{pathname:e,search:n,hash:r}=this.location;if(h===r&&this.U.path===t&&this.U.nt===s)return;this.U.path=t,this.U.nt=s;const o=Object.assign({},this.history.state,{st:this.U,Z:this.M});return this.history.replaceState(o,null,`${e}${n}${h}`)}pt(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get wt(){return this.M?this.M.slice(0,this.U.index+1).map(value=>value.title):[]}q(){return this.location.hash.substring(1).split("?")[0]}async at(t,s=0){const{pathname:i,search:h}=this.location,e=`#${t}`;return s?(this.lt=this.U,await this.history.replaceState({},null,`${i}${h}${e}`)):await this.history.pushState({},null,`${i}${h}${e}`),this.T()}D(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}C(t,s,i){const h=Object.assign({},t,s);h.dt=i,Reporter.write(1e4,"callback",t,s),this.options.C&&this.options.C(h)}}t("HistoryBrowser",o);class l{constructor(){this.g=0,this.vt=(t=>{const s=l.gt(t);s.yt&&(t.preventDefault(),this.options.C(s))}),this.document=document}static gt(t){const s={yt:0,href:null,anchor:null},i=l.bt(t.target);if(!i||!l.$t(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const h=i.getAttribute("href");return s.anchor=i,s.href=h,s.yt=1===t.which,s}static bt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static $t(t){const s=t.getAttribute("target");return!s||s===l.window.name||"_self"===s}P(t){if(this.g)throw Reporter.error(2004);this.g=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.vt,1)}k(){this.document.removeEventListener("click",this.vt,1),this.g=0}}t("LinkHandler",l);class a{constructor(component,t,s,i=0,h=null){this.component=null,this.Ct=null,this.viewport=null,this.Et=null,this.Rt=null,this.i=null,this.St=null,this.Pt(component),this.Vt(t),this.Ot(s),this.kt=i,this.It=h}Pt(component){"string"==typeof component?(this.Ct=component,this.component=null):(this.component=component,this.Ct=component.description.name)}Vt(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.Et=t,this.viewport=null):(this.viewport=t,null!==t&&(this.Et=t.name))}Ot(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.Rt=t,this.i={id:t}):this.i=t}Ht(t){if(null!==this.component)return this.component;const s=t.get(IContainer),i=s.jt(CustomElementResource.Nt(this.Ct));return null!==i?i.Tt(s).At:null}xt(router){return null!==this.viewport?this.viewport:router.qt()[this.Et]}Dt(t,s=0,i=0){return s&&this.Rt!==t.Rt?0:i?this.component===t.component:this.Ct===t.Ct}}class c{constructor(t,s){this.active="",this.Lt=t,Object.assign(this,{title:s.title,children:null,Ut:s.Ut,active:""}),this.instructions=this.zt(s.Bt),this.link=this._t(this.instructions),this.Jt=s.Ft?this._t(this.zt(s.Ft)):this.link,this.Gt=this.Lt.router.Qt.get(IObserverLocator),this.Mt=this.Gt.Wt(0,this.Lt.router,"activeComponents"),this.Mt.subscribe(this)}get Kt(){return this.children&&this.children.length?"nav-has-children":""}Xt(){this.active=this.link&&this.link.length?this.Yt():"nav-active"===this.active?"nav-active":this.Zt()?"nav-active-child":""}Yt(){const t=this.Lt.router.ss.ts(this.Jt),s=this.Lt.router.hs.map(t=>this.Lt.router.ss.es(t));for(const component of t)if(!s.find(t=>t.Dt(component)))return"";return"nav-active"}ns(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}_t(instructions){return this.Lt.router.ss.rs(instructions)}zt(t){if(!Array.isArray(t))return this.zt([t]);const instructions=[];for(const s of t)instructions.push("string"==typeof s?this.Lt.router.ss.es(s):s instanceof a?s:s.component?new a(s.component,s.viewport,s.i):new a(s));return instructions}Zt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Zt())return 1;return 0}}class u{constructor(router,name,t=[]){this.router=router,this.name=name,this.os=t}ls(t){for(const s of t)this.as(this.os,s)}as(t,s){const i=new c(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.as(i.children,t)}}}t("Nav",u);class f{constructor(t,s){this.vt=t,this.names=s}}t("HandlerEntry",f);class p{constructor(t,s){this.cs=t,this.us=s}}t("RouteGenerator",p);class w{constructor(){this.fs=0,this.ps=0,this.ws=0}}t("TypesRecord",w);class d{constructor(t,s,i){this.vt=t,this.ds=s,this.ms=i}}t("RecognizeResult",d);class m{constructor(t,s,i){this.vs=t,this.gs=s,this.repeat=i}ys(t){return this.gs===t.gs&&this.vs===t.vs}}t("CharSpec",m);class State{constructor(t){this.bs=t,this.$s=[]}put(t){let s=this.$s.find(s=>s.bs.ys(t));return void 0===s&&(s=new State(t),this.$s.push(s),t.repeat&&s.$s.push(s)),s}}t("State",State);const v=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;class g{constructor(t,s){this.name=t,this.Cs=t,this.Es=s,this.optional=0}Rs(t){const s=this.Cs,i=s.length;let h=0,e="";if(this.Es)for(;i>h;++h)e=s.charAt(h),t(new m(null,e,0));else for(;i>h;++h)e=s.charAt(h),t(new m(null,e.toUpperCase()+e.toLowerCase(),0))}Ss(){return this.Cs.replace(v,"\\$1")}Ps(t,s){return this.Cs}}t("StaticSegment",g);class y{constructor(name,optional){this.name=name,this.optional=optional}Rs(t){t(new m("/",null,1))}Ss(){return"([^/]+)"}Ps(t,s){return s[this.name]=1,t[this.name]}}t("DynamicSegment",y);class b{constructor(name){this.name=name,this.optional=0}Rs(t){t(new m("",null,1))}Ss(){return"(.+)"}Ps(t,s){return s[this.name]=1,t[this.name]}}t("StarSegment",b);class ${Rs(t){}Ss(){return""}Ps(t,s){return""}}t("EpsilonSegment",$),t("RouteRecognizer",class{constructor(){this.Vs=new State,this.names={},this.os=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.Vs;const i=[];let h="^";const e=new w,n=[],r=t.vt.name;let o=1,l=t.path;"/"===l.charAt(0)&&(l=l.slice(1));const a=[],c=l.split("/");let u,d;for(let r=0,l=c.length;l>r;++r){let l=(u=c[r]).match(/^:([^?]+)(\?)?$/);if(l){const[,name,optional]=l;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);a.push(d=new y(name,!!optional)),n.push(name),e.ps++}else if(l=u.match(/^\*(.+)$/))a.push(d=new b(l[1])),n.push(l[1]),e.ws++;else{if(""===u){a.push(new $);continue}a.push(d=new g(u,t.Es)),e.fs++}const f=s.put(new m(null,"/",0));let p=f;d.Rs(t=>{p=p.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].$s.push(f);d.optional?(i.push(p),h+=`(?:/${d.Ss()})?`):(s=p,h+=`/${d.Ss()}`,i.length=0,o=0)}o&&(s=s.put(new m(null,"/",0)),h+="/?");const v=[new f(t.vt,n)];if(this.os.set(t.vt,new p(a,v)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new p(a,v))}for(let s=0;i.length>s;s++){const n=i[s];n.us=v,n.Ss=RegExp(`${h}$`,t.Es?"":"i"),n.types=e}return s.us=v,s.Ss=RegExp(`${h}$`,t.Es?"":"i"),s.types=e,s}Os(t){return"string"==typeof t?this.names[t]:this.os.get(t)}ks(t){const s=this.Os(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.us]}Is(t){return!!this.Os(t)}Ps(t,s){const i=this.Os(t);if(!i)throw Error(`There is no route named ${t}`);const h=i.us[0].vt;if(h.Hs)return h.href;const e=Object.assign({},s),n=i.cs,r={};let o="";for(let s=0,i=n.length;i>s;s++){const i=n[s];if(i instanceof $)continue;const h=i.Ps(e,r);if(null==h){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=h}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(e,t);const l=buildQueryString(e);return o+(l?`?${l}`:"")}js(t){let s=[this.Vs],i={},h=0,e=t;const n=e.indexOf("?");if(-1!==n){const t=e.slice(n+1);e=e.slice(0,n),i=parseQueryString(t)}"/"!==(e=decodeURI(e)).charAt(0)&&(e=`/${e}`);let r=e.length;r>1&&"/"===e.charAt(r-1)&&(e=e.slice(0,-1),h=1,--r);for(let t=0;r>t;++t){const i=[],h=e.charAt(t);if(s.forEach(t=>{t.$s.forEach(t=>{null!==t.bs.gs?-1!==t.bs.gs.indexOf(h)&&i.push(t):null!==t.bs.vs&&-1===t.bs.vs.indexOf(h)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].us&&o.push(s[t]);o.sort((t,s)=>{if(t.types.ws!==s.types.ws)return t.types.ws-s.types.ws;if(t.types.ws){if(t.types.fs!==s.types.fs)return s.types.fs-t.types.fs;if(t.types.ps!==s.types.ps)return s.types.ps-t.types.ps}return t.types.ps!==s.types.ps?t.types.ps-s.types.ps:t.types.fs!==s.types.fs?s.types.fs-t.types.fs:0});const l=o[0];if(l&&l.us){h&&"(.+)$"===l.Ss.source.slice(-5)&&(e=`${e}/`);const t=e.match(l.Ss);let s=1;const n=[];return n.Ns=i,l.us.forEach(i=>{const h={};i.names.forEach(name=>{h[name]=t[s++]}),n.push(new d(i.vt,h,i.names.length>0))}),n}}});class C{P(t){this.As=Object.assign({viewport:"@",Ts:"+",scope:"/",kt:"!",i:"(",xs:")",qs:"&",add:"+",clear:"-",action:"."},t.As)}get Ds(){return this.As.clear}ts(instructions){return null===instructions||""===instructions?[]:(instructions.startsWith("/")&&(instructions=instructions.slice(1)),instructions.split(this.As.Ts).map(t=>this.es(t)))}es(t){const instructions=t.split(this.As.scope).map(t=>this.Ls(t));for(let t=0;instructions.length-1>t;t++)instructions[t].It=instructions[t+1];return instructions[0]}rs(instructions){return instructions.map(t=>this.Us(t)).join(this.As.Ts)}Us(t,s=0){if("string"==typeof t)return this.zs(t,s);{const instructions=[t];for(;t=t.It;)instructions.push(t);return instructions.map(t=>this.zs(t,s)).join(this.As.scope)}}Bs(t){return t.split(this.As.scope).map(t=>this.es(t))}_s(instructions){return Array.isArray(instructions)?instructions.map(t=>this.Us(t)).join(this.As.scope):this._s([instructions])}Js(t,s){return t&&(s=`/${t}${this.As.scope}${s}`),s}Fs(t){return{Gs:t===this.As.clear||t.startsWith(this.As.clear+this.As.add),Qs:t.startsWith(this.As.clear)?t.slice(2):t}}Ms(t){let s=t.slice().sort((t,s)=>s.split(this.As.scope).length-t.split(this.As.scope).length),i=[];if((s=s.map(value=>`${this.As.scope}${value}${this.As.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.As.scope).length-s.split(this.As.scope).length),i}Ws(t,s=0){const i=t.slice();return s&&i.unshift(this.Ds),i.join(this.As.Ts)}Ls(t){let component,s,i,h;const[e,n]=t.split(this.As.viewport);void 0===n?([component,...i]=e.split(this.As.i),component.endsWith(this.As.kt)&&(h=1,component=component.slice(0,-this.As.kt.length))):(component=e,[s,...i]=n.split(this.As.i),s.endsWith(this.As.kt)&&(h=1,s=s.slice(0,-this.As.kt.length)));let r=i.length?i.join(this.As.i):void 0;return this.As.xs.length&&r&&r.endsWith(this.As.xs)&&(r=r.slice(0,-this.As.xs.length)),new a(component,s,r,h)}zs(t,s=0){if("string"==typeof t)return this.Us(this.es(t),s);{let i=t.Ct;return null===t.Et||s||(i+=this.As.viewport+t.Et),t.Rt&&(i+=this.As.i+t.Rt+this.As.xs),i}}}class E{constructor(){this.Ks=(t=>t),this.Xs=(instructions=>instructions)}}(function(t){t[t.Ys=0]="none",t[t.Zs=1]="created",t[t.loaded=2]="loaded",t[t.ti=3]="initialized",t[t.si=4]="added"})(e||(e={})),(function(t){t.default="default",t.ii="disallow",t.hi="enter",t.refresh="refresh"})(n||(n={}));class R{constructor(t=null,s=null,i=null,h=null){this.content=t,this.i=s,this.ei=i,this.component=null,this.ni=0,this.ri=0,this.oi=0,this.li=0,null!==this.content&&"string"==typeof this.content&&null!==h&&(this.content=this.Ht(h))}ai(t){return"string"==typeof t.content&&this.Ct()===t.content||"string"!=typeof t.content&&this.content===t.content}ci(t){return this.i===t.i&&this.ei.rt===t.ei.rt}ui(){return"reentryBehavior"in this.component?this.component.ui:"default"}fi(t){return("string"==typeof t.content&&this.Ct()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.i===t.i}pi(t){0===this.ni&&(this.oi||(this.component=this.wi(t)),this.ni=1)}di(){1===this.ni&&(this.ni=0)}mi(t,s){if(!this.component)return Promise.resolve(0);if(!this.component.mi)return Promise.resolve(1);const h=i(this.i,this.ei.rt,this.content.i);this.ei.i=h.o,this.ei.l=h.l;const e=this.component.mi(h.u,this.ei,s);return Reporter.write(1e4,"viewport canEnter",e),"boolean"==typeof e?Promise.resolve(e):"string"==typeof e?Promise.resolve([new a(e,t)]):e}vi(t){if(!this.component||!this.component.vi)return Promise.resolve(1);const s=this.component.vi(this.ei,t);return Reporter.write(1e4,"viewport canLeave",s),"boolean"==typeof s?Promise.resolve(s):s}async hi(t){if(this.li||1===this.ni&&!this.ri){if(this.component.hi){const s=i(this.i,this.ei.rt,this.content.i);this.ei.i=s.o,this.ei.l=s.l,await this.component.hi(s.u,this.ei,t)}this.ri=1}}async gi(t){4===this.ni&&this.ri&&(this.component.gi&&await this.component.gi(this.ei,t),this.ri=0)}loadComponent(t,s){if(1===this.ni&&this.ri)return this.oi||this.component.yi(0,t,s),this.ni=2,Promise.resolve()}bi(){2===this.ni&&(this.ni=1)}$i(){2===this.ni&&(this.oi||this.component.Ci(2560,null),this.ni=3)}Ei(t=0){3===this.ni&&(t||(this.component.Ri(5120),this.ni=2))}addComponent(t){if(3===this.ni){if(this.component.Si(512),this.oi){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.ni=4}}Pi(t,s=0){if(4===this.ni&&!this.ri){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.Vi(1024),this.ni=3}}async Oi(t,s,i=0){switch(this.ni){case 4:await this.gi(s),this.Pi(t,i);case 3:this.Ei(i);case 2:this.bi();case 1:this.di()}}Ct(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}Ht(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(IContainer),i=s.jt(CustomElementResource.Nt(this.content));return null!==i?i.Tt(s).At:null}}wi(t){if(null===this.content)return null;const component=this.Ct();return t.get(IContainer).get("string"!=typeof component?component:CustomElementResource.Nt(component))}}class S{constructor(router,name,t,s,i,h,e){this.router=router,this.name=name,this.ki=t,this.context=s,this.Ii=i,this.scope=h,this.options=e,this.clear=0,this.content=new R,this.Hi=null,this.ji=null,this.Ni=null,this.cache=[],this.enabled=1}Ai(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.ss.Ds)this.clear=1,t=null;else{const s=this.router.ss.es(t);t=s.Ct,i=s.Rt}if(this.Hi=new R(t,i,s,this.context),this.options.Ti){const t=this.cache.find(t=>this.Hi.fi(t));t?(this.Hi=t,this.Hi.oi=1):this.cache.push(this.Hi)}return!this.content.ai(this.Hi)||s.K||"refresh"===this.content.ui()?1:"disallow"!==this.content.ui()?this.content.ci(this.Hi)&&"enter"!==this.content.ui()?0:(this.content.li=1,this.Hi.content=this.content.content,this.Hi.component=this.content.component,this.Hi.ni=this.content.ni,this.Hi.li=this.content.li,1):void 0}xi(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.ki&&(this.scope.ki=t),this.ki!==t&&(this.Ni=Object.assign({},this),this.qi(),this.ki=t,i&&i.Di&&(this.options.Di=i.Di),i&&i.default&&(this.options.default=i.default),i&&i.Li&&(this.options.Li=i.Li),i&&i.Ui&&(this.options.Ui=i.Ui),i&&i.Ti&&(this.options.Ti=i.Ti),this.ji&&this.ji()),s&&(s.Et=this.name),this.context!==s&&(this.context=s),this.content.component||this.Hi&&this.Hi.component||!this.options.default||this.router.zi(this.options.default,this)}remove(t,s){return this.ki===t&&this.context===s?(this.content.component&&this.content.Oi(this.ki,this.Hi?this.Hi.ei:null,this.options.Ti).catch(t=>{throw t}),1):0}async vi(){return this.content.vi(this.Hi.ei)}async mi(){return this.clear?1:this.Hi.content?(await this.Bi(),this.Hi.pi(this.context),this.Hi.mi(this,this.content.ei)):0}async hi(){return Reporter.write(1e4,"Viewport enter",this.name),this.clear?1:this.Hi&&this.Hi.component?(await this.Hi.hi(this.content.ei),await this.Hi.loadComponent(this.context,this.ki),this.Hi.$i(),1):0}async _i(){return Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&!this.Hi.component&&(await this.content.gi(this.Hi.ei),this.content.Pi(this.ki,this.options.Ti),this.content.Ei(this.options.Ti),this.content.bi(),this.content.di()),this.Hi.component&&(this.Hi.addComponent(this.ki),this.content.component&&(await this.content.gi(this.Hi.ei),this.content.li||(this.content.Pi(this.ki,this.options.Ti),this.content.Ei(this.options.Ti),this.content.bi(),this.content.di())),this.content=this.Hi,this.content.li=0),this.clear&&(this.content=new R(null,null,this.Hi.ei)),this.Hi=null,1}Ji(){this.Ni=null}async Fi(){await this.Hi.Oi(this.ki,this.Hi?this.Hi.ei:null,this.options.Ti),this.Ni&&Object.assign(this,this.Ni)}description(t=0){if(this.content.content){const component=this.content.Ct();if(t||this.scope||this.options.Gi)return this.router.ss.Us(new a(component,this,this.content.i,null!==this.scope));const s=this.Ii.Qi([new a(component)]);return this.router.ss.Us(new a(component,s&&s.Mi&&s.Mi.length?null:this,this.content.i))}}Wi(t=0){const s=[this.Ii.Ki(t),this.description(t)];return this.router.ss._s(s.filter(value=>value&&value.length))}Xi(component){let t=this.options.Di||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}Yi(component){if("-"===component||null===component)return 1;let t=this.options.Di;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}Zi(t){this.content.component&&this.content.$i()}th(t){Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.Hi),this.enabled=1,this.content.component&&this.content.addComponent(this.ki)}sh(t){Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.Pi(this.ki,this.options.Ti),this.enabled=0}ih(t){this.content.component&&this.content.Ei(this.options.Ti)}qi(){this.options={},this.content=new R,this.cache=[]}async Bi(){return this.ki?Promise.resolve():new Promise(t=>{this.ji=t})}}t("Viewport",S);class Scope{constructor(router,t,s,i){this.router=router,this.ki=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.hh=[],this.eh=null,this.parent&&this.parent.nh(this)}rh(){return this.hh.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}Qi(t){const instructions=[];let s=0;t?(this.eh={},this.Mi=t.slice()):this.Mi||(this.Mi=[]),this.eh=Object.assign({},this.rh(),this.eh);for(let t=0;this.Mi.length>t;t++){const i=this.Mi[t];for(const name in this.eh){const h=this.eh[name];if(h&&h.Xi(i.Ct)){const e=this.oh(i,h);instructions.push(...e.Mi),s=s||e.lh,this.eh[name]=null,this.Mi.splice(t--,1);break}}}for(let t=0;this.Mi.length>t;t++){const i=this.Mi[t],name=i.Et;if(!name||!name.length)continue;const h=i.kt;this.rh()[name]||(this.ah(name,null,null,{scope:h,Gi:1}),this.eh[name]=this.rh()[name]);const e=this.eh[name];if(e&&e.Yi(i.Ct)){const h=this.oh(i,e);instructions.push(...h.Mi),s=s||h.lh,this.eh[name]=null,this.Mi.splice(t--,1)}}for(let t=0;this.Mi.length>t;t++){const i=this.Mi[t],h=[];for(const name in this.eh){const t=this.eh[name];t&&t.Yi(i.Ct)&&h.push(t)}if(1===h.length){const e=h.shift(),n=this.oh(i,e);instructions.push(...n.Mi),s=s||n.lh,this.eh[e.name]=null,this.Mi.splice(t,1);break}}if(s=s||this.Mi.length>0,!t)for(const t of this.children){const i=t.Qi();instructions.push(...i.Mi),s=s||i.lh}return{Mi:instructions,lh:s}}oh(t,s){t.Vt(s);const instructions=[t];let i=0;if(t.It){const h=(s.scope||s.Ii).Qi([t.It]);instructions.push(...h.Mi),i=i||h.lh}return{Mi:instructions,lh:i}}ah(name,t,s,i){let h=this.rh()[name];if(t&&h&&null!==h.ki&&h.ki!==t&&(h.enabled=0,(h=this.hh.find(s=>s.name===name&&s.ki===t))&&(h.enabled=1)),!h){let e;i.scope&&(e=new Scope(this.router,t,s,this),this.router.uh.push(e)),h=new S(this.router,name,null,null,this,e,i),this.hh.push(h)}return(t||s)&&h.xi(t,s,i),h}fh(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.ph(t.scope),this.hh.splice(this.hh.indexOf(t),1)),Object.keys(this.hh).length}ph(){for(const t of this.children)t.ph();const t=this.rh();for(const name in t)this.router.fh(t[name],null,null)}nh(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}wh(t=0,s=0){const i=[];for(const h in this.rh()){const e=this.rh()[h];(e.options.Ui||e.options.Li&&!t)&&!s||i.push(e.Wi(t))}for(const s of this.children)i.push(...s.wh(t));return i.filter(value=>value&&value.length)}qt(){const t=this.hh.filter(t=>t.enabled);for(const s of this.children)t.push(...s.qt());return t}Ki(t=0){if(!this.ki||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.dh(this.context.get(IContainer).parent);for(;i&&i.Ii===this.parent;)s.unshift(i.description(t)),i=this.dh(i.context.get(IContainer).parent);return s.unshift(this.parent.Ki(t)),this.router.ss._s(s.filter(value=>value&&value.length))}dh(t){const s=Object.values(this.rh());for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}t("Scope",Scope);const P=t("IRouteTransformer",DI.vh("IRouteTransformer").mh(t=>t.singleton(E)));t("IRouter",DI.vh("IRouter").mh(t=>t.singleton(V)));class V{constructor(t,s){this.Qt=t,this.uh=[],this.gh={},this.hs=[],this.yh=[],this.g=0,this.bh=[],this.$h=null,this.Ch=null,this.Eh=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.Rh(t.anchor).Ki();s=this.ss.Js(i,s)}this.Sh.pt(s)}),this.Sh=new o,this.Ph=new l,this.ss=new C,this.Vh=s}get Oh(){return null!==this.$h}P(t){if(this.g)throw Reporter.error(2001);return this.g=1,this.options=Object.assign({C:t=>{this.kh(t)},Ks:this.Vh.Ks,Xs:this.Vh.Xs},t),this.ss.P({As:this.options.As}),this.Ph.P({C:this.Eh}),this.Sh.P(this.options).catch(t=>{throw t})}k(){if(!this.g)throw Reporter.error(2e3);this.Ph.k(),this.Sh.k()}kh(t){this.bh.push(t),this.Ih().catch(t=>{throw t})}async Ih(){if(null!==this.$h||!this.bh.length)return Promise.resolve();const t=this.bh.shift();this.$h=t,this.options.Hh&&this.options.Hh(t);let i=0;(t.ht||t.it)&&t.nt&&(t.path=t.nt,i=1);let h=t.path;if(this.options.Ks&&!i){const t=this.options.Ks(h,this);h=Array.isArray(t)?this.ss.rs(t):t}const{Gs:e,Qs:n}=this.ss.Fs(h);e&&(h=n);const r=s(t.rt);t.i=r.i,t.l=r.list;const o=this.ss.ts(h);if(!o&&!o.length&&!e)return this.$h=null,this.Ih();const l=e?this.qt().filter(value=>null!==value.content.component):[],a=this.qt().filter(value=>value.options.default&&null===value.content.component),c=[];let{Mi:u,lh:f}=this.jh.Qi(o),p=100;for(;u.length||f||a.length;){if(!p--)throw Reporter.error(2002);const s=[];for(const i of u){const h=i.viewport,e=this.ss.Us(i,1);h.Ai(e,t)&&s.push(h);const n=l.findIndex(value=>value===h);0>n||l.splice(n,1);const r=a.findIndex(value=>value===h);0>r||a.splice(r,1)}for(const i of l)i.Ai(this.ss.Ds,t)&&s.push(i);let i;for(;i=a.shift();)i.Ai(i.options.default,t)&&s.push(i);let h=await Promise.all(s.map(value=>value.vi()));if(h.findIndex(value=>0==value)>=0)return this.Nh([...s,...c],t);if((h=await Promise.all(s.map(async value=>{const t=await value.mi();if("boolean"==typeof t)return t?value.hi():0;for(const s of t)this.zi(s);return value.Fi().catch(t=>{throw t}),1}))).some(t=>0==t))return this.Nh([...s,...c],t);for(const t of s)c.find(value=>value===t)||c.push(t);const e=this.jh.Qi();let n;for(u=[];n=this.yh.shift();)e.Mi.find(value=>value.viewport===n.viewport)||u.push(n);u=[...u,...e.Mi],f=e.lh}await Promise.all(c.map(value=>value._i())),await this.Ah(t),t.et||t.Th||!c.every(t=>t.options.Ui)||await this.Sh.pop(),c.forEach(t=>{t.Ji()}),this.Ch=this.$h,this.Ch.Th&&(this.Ch.Th=0),this.$h=null,this.Ih().catch(t=>{throw t})}zi(t,s){this.$h?t instanceof a?(t.viewport||(t.viewport=this.qt().find(s=>s.name===t.Et)),this.yh.push(t)):("string"==typeof s&&(s=this.qt().find(t=>t.name===s)),this.yh.push(new a(t,s))):this.Ch&&(this.bh.unshift({path:"",nt:"",Th:1}),this.Ih().catch(t=>{throw t}))}xh(t){return this.qh(),this.Rh(t)}Dh(name){return this.qt().find(t=>t.name===name)}ah(name,t,s,i){return Reporter.write(1e4,"Viewport added",name,t),this.xh(t).ah(name,t,s,i)}fh(t,s,i){const h=t.Ii;h.fh(t,s,i)||this.ph(h)}qt(){return this.qh(),this.jh.qt()}ph(t){if(t!==this.jh){t.ph();const s=this.uh.indexOf(t);0>s||this.uh.splice(s,1)}}ct(t,s,i){if("string"==typeof t)return this.Sh.ct(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.Sh.replace(t,s,i)}refresh(){return this.Sh.refresh()}back(){return this.Sh.back()}forward(){return this.Sh.forward()}Lh(name,t){const s=this.Uh(name);s&&(s.os=[]),this.zh(name,t)}zh(name,t){let s=this.gh[name];s||(s=this.gh[name]=new u(this,name)),s.ls(t),this.gh[name]=new u(s.router,s.name,s.os)}Uh(name){return this.gh[name]}async Nh(t,s){t.forEach(t=>{t.Fi().catch(t=>{throw t})}),s._?await this.Sh.pop():await this.Sh.cancel(),this.$h=null,this.Ih().catch(t=>{throw t})}qh(){if(!this.jh){const t=this.Qt.get(Aurelia).root();this.jh=new Scope(this,t.Bh,t.$context,null),this.uh.push(this.jh)}}Rh(t){let s=t;for(;s.parentElement;){const t=this.qt().find(t=>t.ki===s);if(t&&t.Ii)return t.Ii;s=s.parentElement}return this.jh}Ah(t){this.hs=this.jh.wh(1,1),this.hs=this.ss.Ms(this.hs);let s=this.jh.wh();s=this.ss.Ms(s);let i=this.ss.Ws(s);if(this.options.Xs){const t=this.options.Xs(this.ss.ts(i),this);i=Array.isArray(t)?this.ss.rs(t):t}let h=this.jh.wh(1);h=this.ss.Ms(h);const e=t.rt&&t.rt.length?`?${t.rt}`:"";return this.Sh.ft(i+e,this.ss.Ws(h,1)+e,t)}}t("Router",V),V.inject=[IContainer,P];let O=t("NavCustomElement",class{constructor(router){this.router=router,this.name=null,this.os=null,this.level=0}get _h(){const t=this.router.gh[this.name];return t?t.os:[]}active(t){return"Active"}});h([bindable],O.prototype,"name",void 0),h([bindable],O.prototype,"routes",void 0),h([bindable],O.prototype,"level",void 0),O=t("NavCustomElement",h([inject(V,Element),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],O));class k{constructor(router,t,s){this.router=router,this.ki=t,this.Jh=s,this.name="default",this.scope=null,this.Di=null,this.default=null,this.Li=null,this.Ui=null,this.Ti=null,this.viewport=null}Fh(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.Jh.Gh(dom,i.description,s,i);template.Qh=createRenderContext(dom,s,i.description.dependencies,i),template.Fh(this,host,parts)}bound(){this.connect()}Mh(){this.disconnect()}connect(){const t={scope:this.ki.hasAttribute("scope")};this.Di&&this.Di.length&&(t.Di=this.Di),this.default&&this.default.length&&(t.default=this.default),this.ki.hasAttribute("no-link")&&(t.Li=1),this.ki.hasAttribute("no-history")&&(t.Ui=1),this.ki.hasAttribute("stateful")&&(t.Ti=1),this.viewport=this.router.ah(this.name,this.ki,this.$context,t)}disconnect(){this.router.fh(this.viewport,this.ki,this.$context)}Zi(t){this.viewport&&this.viewport.Zi(t)}th(t){this.viewport&&this.viewport.th(t)}sh(t){this.viewport&&this.viewport.sh(t)}ih(t){this.viewport&&this.viewport.ih(t)}}t("ViewportCustomElement",k),k.inject=[V,INode,IRenderingEngine],h([bindable],k.prototype,"name",void 0),h([bindable],k.prototype,"scope",void 0),h([bindable],k.prototype,"usedBy",void 0),h([bindable],k.prototype,"default",void 0),h([bindable],k.prototype,"noLink",void 0),h([bindable],k.prototype,"noHistory",void 0),h([bindable],k.prototype,"stateful",void 0),CustomElementResource.Wh({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> ${scope ? "[new scope]" : ""} : <b>${viewport.content && viewport.content.componentName()}</b></div></template>'},k);const I=t("RouterRegistration",V),DefaultComponents=t("DefaultComponents",[I]),DefaultResources=(t("ViewportCustomElementRegistration",k),t("NavCustomElementRegistration",O),t("DefaultResources",[k,O]));t("RouterConfiguration",{register:t=>t.register(...DefaultComponents,...DefaultResources),Kh(){return this.register(DI.Kh())}})}}});
