System.register("router",["@aurelia/kernel","@aurelia/runtime","@aurelia/runtime-html"],function(t){"use strict";var Reporter,IContainer,buildQueryString,parseQueryString,DI,inject,ILifecycle,CustomElementResource,IObserverLocator,Controller,Aurelia,bindable,INode,customElement,IDOM,createRenderContext,IRenderingEngine,DOM;return{t:[function(t){Reporter=t.Reporter,IContainer=t.IContainer,buildQueryString=t.buildQueryString,parseQueryString=t.parseQueryString,DI=t.DI,inject=t.inject},function(t){ILifecycle=t.ILifecycle,CustomElementResource=t.CustomElementResource,IObserverLocator=t.IObserverLocator,Controller=t.Controller,Aurelia=t.Aurelia,bindable=t.bindable,INode=t.INode,customElement=t.customElement,IDOM=t.IDOM,createRenderContext=t.createRenderContext,IRenderingEngine=t.IRenderingEngine},function(t){DOM=t.DOM}],s(){function s(t){const s={},i=[];if(!t||!t.length)return{i:s,list:i};const e=t.replace("+"," ").split("&");for(const t of e){const e=t.split("="),n=decodeURIComponent(e.shift());if(!e.length){i.push(n);continue}const value=decodeURIComponent(e.shift());s[n]=value}return{i:s,list:i}}function i(t,i,e){const n=s(i),r=s(t),o={...n.i,...r.i},l=[...n.list,...r.list];if(l.length&&e&&e.length)for(const t of e)o[t]=l.shift();let a;return l.length&&Object.keys(o).length&&(o["o"]=l.splice(0,l.length)),{l:o,u:l,p:a=l.length?l:o}}function e(t,s,i,e){var n,r,o=arguments.length,l=3>o?s:null===e?e=Object.getOwnPropertyDescriptor(s,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,s,i,e);else for(r=t.length-1;r>=0;r--)(n=t[r])&&(l=(3>o?n(l):o>3?n(s,i,l):n(s,i))||l);return o>3&&l&&Object.defineProperty(s,i,l),l}var n,r;t({v:void 0,m:void 0});class o{constructor(t){this.g=(async t=>this.$(this,"popstate",[t])),this.C=t,this.R=[],this.S=0,this.V=null,this.P=null,this.I=null,this.k=null}H(t){if(this.S)throw Reporter.error(2003);this.S=1,this.P=t,this.C.N(this.A,this,4096),DOM.window.addEventListener("popstate",this.g)}O(){DOM.window.removeEventListener("popstate",this.g),this.C.T(this.A,this),this.P=null,this.S=0}get length(){return DOM.window.history.length}get state(){return DOM.window.history.state}get j(){return DOM.window.history.j}async go(t,s=0){if(!s)return this.$(this,"_go",[t],1);const i=this.$(this,"suppressPopstate",[],1);return this.$(DOM.window.history,"go",[t]).catch(t=>{throw t}),i}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){return this.$(DOM.window.history,"pushState",[t,s,i])}async replaceState(t,s,i){return this.$(DOM.window.history,"replaceState",[t,s,i])}async q(t){if(this.k){const t=this.k;this.k=null,t()}else{if(this.I){const t=this.I;this.I=null,t(),await Promise.resolve()}this.P(t)}}D(t,s){this.I=s,DOM.window.history.go(t)}B(t){this.k=t}$(t,s,i,e=0){let n;const r=new Promise(t=>{n=t});return e&&(i.push(n),n=null),this.R.push({target:t,L:s,i,resolve:n}),r}async A(t){if(!this.R.length||null!==this.V)return;this.V=this.R.shift();const s=this.V.target[this.V.L];Reporter.write(1e4,"DEQUEUE",this.V.L,this.V.i),s.apply(this.V.target,this.V.i);const i=this.V.resolve;this.V=null,i&&i()}}t("QueuedBrowserHistory",o),o.inject=[ILifecycle];class l{constructor(t){this.U=(async()=>{const t=this.J(),s=this.F();Reporter.write(1e4,"path changed to",t,this.G,this.M);const i={};let e,n=this.W("HistoryEntry");if(this.G&&this.G.path===t){i.K=1;const t=this.X?this.M.index:this.history.length-this.Y;e=this.M,this.M=this.G,this.M.index=t,this.X?(this.Z=0,this.tt[this.M.index]=this.M,this.st?(i.it=1,this.st=0):i.ht=1,this.X=0):(this.Z=1,this.tt=this.tt.slice(0,this.M.index),this.tt.push(this.M)),await this.et({nt:this.tt,rt:this.Y,ot:this.M})}else this.tt=this.tt||this.W("HistoryEntries")||[],this.Y=this.Y||this.W("HistoryOffset")||0,n||this.M?n?this.M?n.index>this.M.index?i.lt=1:this.M.index>n.index&&(i.at=1):i.it=1:i.K=1:(i.K=1,i.ct=1,this.Y=this.history.length),n||(n={path:t,ut:null,index:this.history.length-this.Y,ft:s},i.ct&&(n.pt=1),this.tt=this.tt.slice(0,n.index),this.tt.push(n),await this.et({nt:this.tt,rt:this.Y,ot:n})),this.Z=this.M?n.index-this.M.index:0,e=this.M,this.M=n;this.G=null,Reporter.write(1e4,"navigated",this.W("HistoryEntry"),this.tt,this.W("HistoryOffset")),this.P(this.M,i,e)}),this.history=new o(t),this.M=null,this.tt=null,this.Y=null,this.wt=null,this.G=null,this.options=null,this.S=0,this.Z=null,this.X=0,this.st=0}H(t){if(this.S)throw Reporter.error(0);return this.S=1,this.options={...t},this.history.H(this.U),Promise.resolve().then(()=>{this.dt(this.J(),1).catch(t=>{throw t})})}O(){this.history.O(),this.S=0}vt(t,s,i){return this.G={path:t,ut:null,title:s,data:i},this.dt(t)}replace(t,s,i){return this.X=1,this.G={path:t,ut:null,title:s,data:i},this.dt(t,1)}async refresh(){if(this.M)return this.st=1,this.replace(this.M.path,this.M.title,this.M.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){const t=this.Z;return t?(this.Z=0,this.history.go(-t,1)):this.replace(this.wt.path,this.wt.title,this.wt.data)}async pop(){await this.history.go(-1,1);const t=""+this.location,s=this.history.state;if(!s.ot.pt)return await this.history.go(-1,1),this.history.pushState(s,null,t)}async et(t,value){const{pathname:s,search:i,hash:e}=this.location;let n={...this.history.state};return"string"==typeof t?n[t]=JSON.parse(JSON.stringify(value)):n={...n,...JSON.parse(JSON.stringify(t))},this.history.replaceState(n,null,`${s}${i}${e}`)}W(t){return{...this.history.state}[t]}gt(t){return this.M.title=t,this.tt[this.M.index]=this.M,this.et({nt:this.tt,ot:this.M})}yt(t,s,i){if(i.index!==this.M.index)return;const e=`#${t}`,{pathname:n,search:r,hash:o}=this.location;if(e===o&&this.M.path===t&&this.M.ut===s)return;this.M.path=t,this.M.ut=s;const l={...this.history.state,ot:this.M,nt:this.tt};return this.history.replaceState(l,null,`${n}${r}${e}`)}$t(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get Ct(){return this.tt?this.tt.slice(0,this.M.index+1).map(value=>value.title):[]}J(){return this.location.hash.substring(1).split("?")[0]}async dt(t,s=0){const{pathname:i,search:e}=this.location,n=`#${t}`;return s?(this.wt=this.M,await this.history.replaceState({},null,`${i}${e}${n}`)):await this.history.pushState({},null,`${i}${e}${n}`),this.U()}F(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}P(t,s,i){const e={...t,...s};e.bt=i,Reporter.write(1e4,"callback",t,s),this.options.P&&this.options.P(e)}}t("HistoryBrowser",l),l.inject=[ILifecycle];class a{constructor(){this.S=0,this.Rt=(t=>{const s=a.St(t);s.Et&&(t.preventDefault(),this.options.P(s))})}static St(t){const s={Et:0,href:null,anchor:null},i=a.Vt(t.target);if(!i||!a.Pt(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const e=i.getAttribute("href");return s.anchor=i,s.href=e,s.Et=1===t.which,s}static Vt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static Pt(t){const s=t.getAttribute("target");return!s||s===DOM.window.name||"_self"===s}H(t){if(this.S)throw Reporter.error(2004);this.S=1,this.options={...t},DOM.document.addEventListener("click",this.Rt,1)}O(){DOM.document.removeEventListener("click",this.Rt,1),this.S=0}}t("LinkHandler",a);class c{constructor(component,t,s,i=0,e=null){this.component=null,this.It=null,this.viewport=null,this.kt=null,this.Ht=null,this.i=null,this.Nt=null,this.At(component),this.Ot(t),this.Tt(s),this.xt=i,this.jt=e}At(component){"string"==typeof component?(this.It=component,this.component=null):(this.component=component,this.It=component.description.name)}Ot(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.kt=t,this.viewport=null):(this.viewport=t,null!==t&&(this.kt=t.name))}Tt(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.Ht=t,this.i={id:t}):this.i=t}qt(t){if(null!==this.component)return this.component;const s=t.get(IContainer),i=s.Dt(CustomElementResource.Bt(this.It));return null!==i?i.Ut(s).Lt:null}zt(router){return null!==this.viewport?this.viewport:router._t()[this.kt]}Jt(t,s=0,i=0){return s&&this.Ht!==t.Ht?0:i?this.component===t.component:this.It===t.It}}t("ViewportInstruction",c);class u{constructor(t,s){this.active="",this.Ft=t,Object.assign(this,{title:s.title,children:null,Gt:s.Gt,active:""}),this.instructions=this.Qt(s.Mt),this.link=this.Wt(this.instructions),this.Kt=s.Xt?this.Wt(this.Qt(s.Xt)):this.link,this.Yt=this.Ft.router.Zt.get(IObserverLocator),this.ts=this.Yt.ss(0,this.Ft.router,"activeComponents"),this.ts.subscribe(this)}get hs(){return this.children&&this.children.length?"nav-has-children":""}es(){this.active=this.link&&this.link.length?this.ns():"nav-active"===this.active?"nav-active":this.rs()?"nav-active-child":""}ns(){const t=this.Ft.router.ls.os(this.Kt),s=this.Ft.router.as.map(t=>this.Ft.router.ls.cs(t));for(const component of t)if(!s.find(t=>t.Jt(component)))return"";return"nav-active"}us(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}Wt(instructions){return this.Ft.router.ls.fs(instructions)}Qt(t){if(!Array.isArray(t))return this.Qt([t]);const instructions=[];for(const s of t)instructions.push("string"==typeof s?this.Ft.router.ls.cs(s):s instanceof c?s:s.component?new c(s.component,s.viewport,s.i):new c(s));return instructions}rs(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.rs())return 1;return 0}}class f{constructor(router,name,t=[]){this.router=router,this.name=name,this.ps=t}ws(t){for(const s of t)this.ds(this.ps,s)}ds(t,s){const i=new u(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.ds(i.children,t)}}}t("Nav",f);class p{constructor(t,s){this.Rt=t,this.names=s}}t("HandlerEntry",p);class w{constructor(t,s){this.vs=t,this.ms=s}}t("RouteGenerator",w);class d{constructor(){this.gs=0,this.ys=0,this.$s=0}}t("TypesRecord",d);class v{constructor(t,s,i){this.Rt=t,this.Cs=s,this.bs=i}}t("RecognizeResult",v);class m{constructor(t,s,i){this.Rs=t,this.Ss=s,this.repeat=i}Es(t){return this.Ss===t.Ss&&this.Rs===t.Rs}}t("CharSpec",m);class State{constructor(t){this.Vs=t,this.Ps=[]}put(t){let s=this.Ps.find(s=>s.Vs.Es(t));return void 0===s&&(s=new State(t),this.Ps.push(s),t.repeat&&s.Ps.push(s)),s}}t("State",State);const g=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;class y{constructor(t,s){this.name=t,this.Is=t,this.ks=s,this.optional=0}Hs(t){const s=this.Is,i=s.length;let e=0,n="";if(this.ks)for(;i>e;++e)n=s.charAt(e),t(new m(null,n,0));else for(;i>e;++e)n=s.charAt(e),t(new m(null,n.toUpperCase()+n.toLowerCase(),0))}Ns(){return this.Is.replace(g,"\\$1")}As(t,s){return this.Is}}t("StaticSegment",y);class ${constructor(name,optional){this.name=name,this.optional=optional}Hs(t){t(new m("/",null,1))}Ns(){return"([^/]+)"}As(t,s){return s[this.name]=1,t[this.name]}}t("DynamicSegment",$);class C{constructor(name){this.name=name,this.optional=0}Hs(t){t(new m("",null,1))}Ns(){return"(.+)"}As(t,s){return s[this.name]=1,t[this.name]}}t("StarSegment",C);class b{Hs(t){}Ns(){return""}As(t,s){return""}}t("EpsilonSegment",b),t("RouteRecognizer",class{constructor(){this.Os=new State,this.names={},this.ps=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.Os;const i=[];let e="^";const n=new d,r=[],o=t.Rt.name;let l=1,a=t.path;"/"===a.charAt(0)&&(a=a.slice(1));const c=[],u=a.split("/");let f,v;for(let o=0,a=u.length;a>o;++o){let a=(f=u[o]).match(/^:([^?]+)(\?)?$/);if(a){const[,name,optional]=a;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);c.push(v=new $(name,!!optional)),r.push(name),n.ys++}else if(a=f.match(/^\*(.+)$/))c.push(v=new C(a[1])),r.push(a[1]),n.$s++;else{if(""===f){c.push(new b);continue}c.push(v=new y(f,t.ks)),n.gs++}const p=s.put(new m(null,"/",0));let w=p;v.Hs(t=>{w=w.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].Ps.push(p);v.optional?(i.push(w),e+=`(?:/${v.Ns()})?`):(s=w,e+=`/${v.Ns()}`,i.length=0,l=0)}l&&(s=s.put(new m(null,"/",0)),e+="/?");const g=[new p(t.Rt,r)];if(this.ps.set(t.Rt,new w(c,g)),o){const t=Array.isArray(o)?o:[o];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new w(c,g))}for(let s=0;i.length>s;s++){const r=i[s];r.ms=g,r.Ns=RegExp(`${e}$`,t.ks?"":"i"),r.types=n}return s.ms=g,s.Ns=RegExp(`${e}$`,t.ks?"":"i"),s.types=n,s}Ts(t){return"string"==typeof t?this.names[t]:this.ps.get(t)}xs(t){const s=this.Ts(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.ms]}js(t){return!!this.Ts(t)}As(t,s){const i=this.Ts(t);if(!i)throw Error(`There is no route named ${t}`);const e=i.ms[0].Rt;if(e.qs)return e.href;const n={...s},r=i.vs,o={};let l="";for(let s=0,i=r.length;i>s;s++){const i=r[s];if(i instanceof b)continue;const e=i.As(n,o);if(null==e){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else l+="/",l+=e}"/"!==l.charAt(0)&&(l=`/${l}`);for(const t in o)Reflect.deleteProperty(n,t);const a=buildQueryString(n);return l+(a?`?${a}`:"")}Ds(t){let s=[this.Os],i={},e=0,n=t;const r=n.indexOf("?");if(-1!==r){const t=n.slice(r+1);n=n.slice(0,r),i=parseQueryString(t)}"/"!==(n=decodeURI(n)).charAt(0)&&(n=`/${n}`);let o=n.length;o>1&&"/"===n.charAt(o-1)&&(n=n.slice(0,-1),e=1,--o);for(let t=0;o>t;++t){const i=[],e=n.charAt(t);if(s.forEach(t=>{t.Ps.forEach(t=>{null!==t.Vs.Ss?-1!==t.Vs.Ss.indexOf(e)&&i.push(t):null!==t.Vs.Rs&&-1===t.Vs.Rs.indexOf(e)&&i.push(t)})}),0===(s=i).length)break}const l=[];for(let t=0,i=s.length;i>t;t++)s[t].ms&&l.push(s[t]);l.sort((t,s)=>{if(t.types.$s!==s.types.$s)return t.types.$s-s.types.$s;if(t.types.$s){if(t.types.gs!==s.types.gs)return s.types.gs-t.types.gs;if(t.types.ys!==s.types.ys)return s.types.ys-t.types.ys}return t.types.ys!==s.types.ys?t.types.ys-s.types.ys:t.types.gs!==s.types.gs?s.types.gs-t.types.gs:0});const a=l[0];if(a&&a.ms){e&&"(.+)$"===a.Ns.source.slice(-5)&&(n=`${n}/`);const t=n.match(a.Ns);let s=1;const r=[];return r.Bs=i,a.ms.forEach(i=>{const e={};i.names.forEach(name=>{e[name]=t[s++]}),r.push(new v(i.Rt,e,i.names.length>0))}),r}}});class R{constructor(){this.Ls=(t=>t),this.Us=(instructions=>instructions)}}(function(t){t[t.zs=0]="none",t[t._s=1]="created",t[t.loaded=2]="loaded",t[t.Js=3]="initialized",t[t.Fs=4]="added"})(n||(n=t("ContentStatus",{}))),(function(t){t.default="default",t.Gs="disallow",t.Qs="enter",t.refresh="refresh"})(r||(r=t("ReentryBehavior",{})));class S{constructor(t=null,s=null,i=null,e=null){this.content=t,this.i=s,this.Ms=i,this.component=null,this.Ws=0,this.Ks=0,this.Xs=0,this.Ys=0,null!==this.content&&"string"==typeof this.content&&null!==e&&(this.content=this.qt(e))}Zs(t){return"string"==typeof t.content&&this.It()===t.content||"string"!=typeof t.content&&this.content===t.content}ti(t){return this.i===t.i&&this.Ms.ft===t.Ms.ft}si(){return"reentryBehavior"in this.component?this.component.si:"default"}ii(t){return("string"==typeof t.content&&this.It()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.i===t.i}hi(t){0===this.Ws&&(this.Xs||(this.component=this.ei(t)),this.Ws=1)}ni(){1===this.Ws&&(this.Ws=0)}ri(t,s){if(!this.component)return Promise.resolve(0);if(!this.component.ri)return Promise.resolve(1);const e=i(this.i,this.Ms.ft,this.content.i);this.Ms.i=e.l,this.Ms.u=e.u;const n=this.component.ri(e.p,this.Ms,s);return Reporter.write(1e4,"viewport canEnter",n),"boolean"==typeof n?Promise.resolve(n):"string"==typeof n?Promise.resolve([new c(n,t)]):n}oi(t){if(!this.component||!this.component.oi)return Promise.resolve(1);const s=this.component.oi(this.Ms,t);return Reporter.write(1e4,"viewport canLeave",s),"boolean"==typeof s?Promise.resolve(s):s}async Qs(t){if(this.Ys||1===this.Ws&&!this.Ks){if(this.component.Qs){const s=i(this.i,this.Ms.ft,this.content.i);this.Ms.i=s.l,this.Ms.u=s.u,await this.component.Qs(s.p,this.Ms,t)}this.Ks=1}}async li(t){4===this.Ws&&this.Ks&&(this.component.li&&await this.component.li(this.Ms,t),this.Ks=0)}loadComponent(t,s){if(1===this.Ws&&this.Ks)return this.Xs||Controller.ai(this.component,t,s),this.Ws=2,Promise.resolve()}ci(){2===this.Ws&&(this.Ws=1)}ui(){2===this.Ws&&(this.Xs||this.component.fi.bind(5120,null),this.Ws=3)}pi(t=0){3===this.Ws&&(t||(this.component.fi.wi(10240),this.Ws=2))}addComponent(t){if(3===this.Ws){if(this.component.fi.di(1024),this.Xs){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.Ws=4}}vi(t,s=0){if(4===this.Ws&&!this.Ks){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.fi.detach(2048),this.Ws=3}}async mi(t,s,i=0){switch(this.Ws){case 4:await this.li(s),this.vi(t,i);case 3:this.pi(i);case 2:this.ci();case 1:this.ni()}}It(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}qt(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(IContainer),i=s.Dt(CustomElementResource.Bt(this.content));return null!==i?i.Ut(s).Lt:null}}ei(t){if(null===this.content)return null;const component=this.It();return t.get(IContainer).get("string"!=typeof component?component:CustomElementResource.Bt(component))}}t("ViewportContent",S);class E{constructor(router,name,t,s,i,e,n){this.router=router,this.name=name,this.gi=t,this.context=s,this.yi=i,this.scope=e,this.options=n,this.clear=0,this.content=new S,this.$i=null,this.Ci=null,this.bi=null,this.cache=[],this.enabled=1}Ri(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.ls.Si)this.clear=1,t=null;else{const s=this.router.ls.cs(t);t=s.It,i=s.Ht}if(this.$i=new S(t,i,s,this.context),this.options.Ei){const t=this.cache.find(t=>this.$i.ii(t));t?(this.$i=t,this.$i.Xs=1):this.cache.push(this.$i)}return!this.content.Zs(this.$i)||s.it||"refresh"===this.content.si()?1:"disallow"!==this.content.si()?this.content.ti(this.$i)&&"enter"!==this.content.si()?0:(this.content.Ys=1,this.$i.content=this.content.content,this.$i.component=this.content.component,this.$i.Ws=this.content.Ws,this.$i.Ys=this.content.Ys,1):void 0}Vi(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.gi&&(this.scope.gi=t),this.gi!==t&&(this.bi={...this},this.Pi(),this.gi=t,i&&i.Ii&&(this.options.Ii=i.Ii),i&&i.default&&(this.options.default=i.default),i&&i.ki&&(this.options.ki=i.ki),i&&i.Hi&&(this.options.Hi=i.Hi),i&&i.Ei&&(this.options.Ei=i.Ei),this.Ci&&this.Ci()),s&&(s.kt=this.name),this.context!==s&&(this.context=s),this.content.component||this.$i&&this.$i.component||!this.options.default||this.router.Ni(this.options.default,this)}remove(t,s){return this.gi===t&&this.context===s?(this.content.component&&this.content.mi(this.gi,this.$i?this.$i.Ms:null,this.options.Ei).catch(t=>{throw t}),1):0}async oi(){return this.content.oi(this.$i.Ms)}async ri(){return this.clear?1:this.$i.content?(await this.Ai(),this.$i.hi(this.context),this.$i.ri(this,this.content.Ms)):0}async Qs(){return Reporter.write(1e4,"Viewport enter",this.name),this.clear?1:this.$i&&this.$i.component?(await this.$i.Qs(this.content.Ms),await this.$i.loadComponent(this.context,this.gi),this.$i.ui(),1):0}async Oi(){return Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&!this.$i.component&&(await this.content.li(this.$i.Ms),this.content.vi(this.gi,this.options.Ei),this.content.pi(this.options.Ei),this.content.ci(),this.content.ni()),this.$i.component&&(this.$i.addComponent(this.gi),this.content.component&&(await this.content.li(this.$i.Ms),this.content.Ys||(this.content.vi(this.gi,this.options.Ei),this.content.pi(this.options.Ei),this.content.ci(),this.content.ni())),this.content=this.$i,this.content.Ys=0),this.clear&&(this.content=new S(null,null,this.$i.Ms)),this.$i=null,1}Ti(){this.bi=null}async xi(){await this.$i.mi(this.gi,this.$i?this.$i.Ms:null,this.options.Ei),this.bi&&Object.assign(this,this.bi)}description(t=0){if(this.content.content){const component=this.content.It();if(t||this.scope||this.options.ji)return this.router.ls.qi(new c(component,this,this.content.i,null!==this.scope));const s=this.yi.Di([new c(component)]);return this.router.ls.qi(new c(component,s&&s.Bi&&s.Bi.length?null:this,this.content.i))}}Li(t=0){const s=[this.yi.Ui(t),this.description(t)];return this.router.ls.zi(s.filter(value=>value&&value.length))}_i(component){let t=this.options.Ii||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}Ji(component){if("-"===component||null===component)return 1;let t=this.options.Ii;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}Fi(t){this.content.component&&this.content.ui()}Gi(t){Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.$i),this.enabled=1,this.content.component&&this.content.addComponent(this.gi)}Qi(t){Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.vi(this.gi,this.options.Ei),this.enabled=0}Mi(t){this.content.component&&this.content.pi(this.options.Ei)}Pi(){this.options={},this.content=new S,this.cache=[]}async Ai(){return this.gi?Promise.resolve():new Promise(t=>{this.Ci=t})}}t("Viewport",E);class Scope{constructor(router,t,s,i){this.router=router,this.gi=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.Wi=[],this.Ki=null,this.parent&&this.parent.Xi(this)}Yi(){return this.Wi.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}Di(t){const instructions=[];let s=0;t?(this.Ki={},this.Bi=t.slice()):this.Bi||(this.Bi=[]),this.Ki={...this.Yi(),...this.Ki};for(let t=0;this.Bi.length>t;t++){const i=this.Bi[t];for(const name in this.Ki){const e=this.Ki[name];if(e&&e._i(i.It)){const n=this.Zi(i,e);instructions.push(...n.Bi),s=s||n.th,this.Ki[name]=null,this.Bi.splice(t--,1);break}}}for(let t=0;this.Bi.length>t;t++){const i=this.Bi[t],name=i.kt;if(!name||!name.length)continue;const e=i.xt;this.Yi()[name]||(this.sh(name,null,null,{scope:e,ji:1}),this.Ki[name]=this.Yi()[name]);const n=this.Ki[name];if(n&&n.Ji(i.It)){const e=this.Zi(i,n);instructions.push(...e.Bi),s=s||e.th,this.Ki[name]=null,this.Bi.splice(t--,1)}}for(let t=0;this.Bi.length>t;t++){const i=this.Bi[t],e=[];for(const name in this.Ki){const t=this.Ki[name];t&&t.Ji(i.It)&&e.push(t)}if(1===e.length){const n=e.shift(),r=this.Zi(i,n);instructions.push(...r.Bi),s=s||r.th,this.Ki[n.name]=null,this.Bi.splice(t,1);break}}if(s=s||this.Bi.length>0,!t)for(const t of this.children){const i=t.Di();instructions.push(...i.Bi),s=s||i.th}return{Bi:instructions,th:s}}Zi(t,s){t.Ot(s);const instructions=[t];let i=0;if(t.jt){const e=(s.scope||s.yi).Di([t.jt]);instructions.push(...e.Bi),i=i||e.th}return{Bi:instructions,th:i}}sh(name,t,s,i){let e=this.Yi()[name];if(t&&e&&null!==e.gi&&e.gi!==t&&(e.enabled=0,(e=this.Wi.find(s=>s.name===name&&s.gi===t))&&(e.enabled=1)),!e){let n;i.scope&&(n=new Scope(this.router,t,s,this),this.router.ih.push(n)),e=new E(this.router,name,null,null,this,n,i),this.Wi.push(e)}return(t||s)&&e.Vi(t,s,i),e}hh(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.eh(t.scope),this.Wi.splice(this.Wi.indexOf(t),1)),Object.keys(this.Wi).length}eh(){for(const t of this.children)t.eh();const t=this.Yi();for(const name in t)this.router.hh(t[name],null,null)}Xi(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}nh(t=0,s=0){const i=[];for(const e in this.Yi()){const n=this.Yi()[e];(n.options.Hi||n.options.ki&&!t)&&!s||i.push(n.Li(t))}for(const s of this.children)i.push(...s.nh(t));return i.filter(value=>value&&value.length)}_t(){const t=this.Wi.filter(t=>t.enabled);for(const s of this.children)t.push(...s._t());return t}Ui(t=0){if(!this.gi||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.rh(this.context.get(IContainer).parent);for(;i&&i.yi===this.parent;)s.unshift(i.description(t)),i=this.rh(i.context.get(IContainer).parent);return s.unshift(this.parent.Ui(t)),this.router.ls.zi(s.filter(value=>value&&value.length))}rh(t){const s=Object.values(this.Yi());for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}t("Scope",Scope);const V=t("IRouteTransformer",DI.lh("IRouteTransformer").oh(t=>t.singleton(R)));t("IRouter",DI.lh("IRouter").oh(t=>t.singleton(P)));class P{constructor(t,s,i,e,n){this.ih=[],this.ah={},this.as=[],this.uh=[],this.S=0,this.fh=[],this.ph=null,this.wh=null,this.dh=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.vh(t.anchor).Ui();s=this.ls.mh(i,s)}this.gh.$t(s)}),this.Zt=t,this.yh=s,this.gh=i,this.$h=e,this.ls=n}get Ch(){return null!==this.ph}H(t){if(this.S)throw Reporter.error(2001);return this.S=1,this.options={P:t=>{this.bh(t)},Ls:this.yh.Ls,Us:this.yh.Us,...t},this.ls.H({Rh:this.options.Rh}),this.$h.H({P:this.dh}),this.gh.H(this.options).catch(t=>{throw t})}O(){if(!this.S)throw Reporter.error(2e3);this.$h.O(),this.gh.O()}bh(t){this.fh.push(t),this.Sh().catch(t=>{throw t})}async Sh(){if(null!==this.ph||!this.fh.length)return Promise.resolve();const t=this.fh.shift();this.ph=t,this.options.Eh&&this.options.Eh(t);let i=0;(t.at||t.lt)&&t.ut&&(t.path=t.ut,i=1);let e=t.path;if(this.options.Ls&&!i){const t=this.options.Ls(e,this);e=Array.isArray(t)?this.ls.fs(t):t}const{Vh:n,Ph:r}=this.ls.Ih(e);n&&(e=r);const o=s(t.ft);t.i=o.i,t.u=o.list;const l=this.ls.os(e);if(!l&&!l.length&&!n)return this.ph=null,this.Sh();const a=n?this._t().filter(value=>null!==value.content.component):[],c=this._t().filter(value=>value.options.default&&null===value.content.component),u=[];let{Bi:f,th:p}=this.kh.Di(l),w=100;for(;f.length||p||c.length;){if(!w--)throw Reporter.error(2002);const s=[];for(const i of f){const e=i.viewport,n=this.ls.qi(i,1);e.Ri(n,t)&&s.push(e);const r=a.findIndex(value=>value===e);0>r||a.splice(r,1);const o=c.findIndex(value=>value===e);0>o||c.splice(o,1)}for(const i of a)i.Ri(this.ls.Si,t)&&s.push(i);let i;for(;i=c.shift();)i.Ri(i.options.default,t)&&s.push(i);let e=await Promise.all(s.map(value=>value.oi()));if(e.findIndex(value=>0==value)>=0)return this.Hh([...s,...u],t);if((e=await Promise.all(s.map(async value=>{const t=await value.ri();if("boolean"==typeof t)return t?value.Qs():0;for(const s of t)this.Ni(s);return value.xi().catch(t=>{throw t}),1}))).some(t=>0==t))return this.Hh([...s,...u],t);for(const t of s)u.find(value=>value===t)||u.push(t);const n=this.kh.Di();let r;for(f=[];r=this.uh.shift();)n.Bi.find(value=>value.viewport===r.viewport)||f.push(r);f=[...f,...n.Bi],p=n.th}await Promise.all(u.map(value=>value.Oi())),await this.Nh(t),t.ct||t.Ah||!u.every(t=>t.options.Hi)||await this.gh.pop(),u.forEach(t=>{t.Ti()}),this.wh=this.ph,this.wh.Ah&&(this.wh.Ah=0),this.ph=null,this.Sh().catch(t=>{throw t})}Ni(t,s){this.ph?t instanceof c?(t.viewport||(t.viewport=this._t().find(s=>s.name===t.kt)),this.uh.push(t)):("string"==typeof s&&(s=this._t().find(t=>t.name===s)),this.uh.push(new c(t,s))):this.wh&&(this.fh.unshift({path:"",ut:"",Ah:1}),this.Sh().catch(t=>{throw t}))}Oh(t){return this.Th(),this.vh(t)}xh(name){return this._t().find(t=>t.name===name)}sh(name,t,s,i){return Reporter.write(1e4,"Viewport added",name,t),this.Oh(t).sh(name,t,s,i)}hh(t,s,i){const e=t.yi;e.hh(t,s,i)||this.eh(e)}_t(){return this.Th(),this.kh._t()}eh(t){if(t!==this.kh){t.eh();const s=this.ih.indexOf(t);0>s||this.ih.splice(s,1)}}vt(t,s,i){if("string"==typeof t)return this.gh.vt(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.gh.replace(t,s,i)}refresh(){return this.gh.refresh()}back(){return this.gh.back()}forward(){return this.gh.forward()}jh(name,t){const s=this.qh(name);s&&(s.ps=[]),this.Dh(name,t)}Dh(name,t){let s=this.ah[name];s||(s=this.ah[name]=new f(this,name)),s.ws(t),this.ah[name]=new f(s.router,s.name,s.ps)}qh(name){return this.ah[name]}async Hh(t,s){t.forEach(t=>{t.xi().catch(t=>{throw t})}),s.K?await this.gh.pop():await this.gh.cancel(),this.ph=null,this.Sh().catch(t=>{throw t})}Th(){if(!this.kh){const t=this.Zt.get(Aurelia).root;this.kh=new Scope(this,t.host,t.controller.context,null),this.ih.push(this.kh)}}vh(t){let s=t;for(;s.parentElement;){const t=this._t().find(t=>t.gi===s);if(t&&t.yi)return t.yi;s=s.parentElement}return this.kh}Nh(t){this.as=this.kh.nh(1,1),this.as=this.ls.Bh(this.as);let s=this.kh.nh();s=this.ls.Bh(s);let i=this.ls.Lh(s);if(this.options.Us){const t=this.options.Us(this.ls.os(i),this);i=Array.isArray(t)?this.ls.fs(t):t}let e=this.kh.nh(1);e=this.ls.Bh(e);const n=t.ft&&t.ft.length?`?${t.ft}`:"";return this.gh.yt(i+n,this.ls.Lh(e,1)+n,t)}}t("Router",P),P.inject=[IContainer,V,l,a,class{H(t){this.Rh={viewport:"@",Uh:"+",scope:"/",xt:"!",i:"(",zh:")",_h:"&",add:"+",clear:"-",action:".",...t.Rh}}get Si(){return this.Rh.clear}os(instructions){return null===instructions||""===instructions?[]:(instructions.startsWith("/")&&(instructions=instructions.slice(1)),instructions.split(this.Rh.Uh).map(t=>this.cs(t)))}cs(t){const instructions=t.split(this.Rh.scope).map(t=>this.Jh(t));for(let t=0;instructions.length-1>t;t++)instructions[t].jt=instructions[t+1];return instructions[0]}fs(instructions){return instructions.map(t=>this.qi(t)).join(this.Rh.Uh)}qi(t,s=0){if("string"==typeof t)return this.Fh(t,s);{const instructions=[t];for(;t=t.jt;)instructions.push(t);return instructions.map(t=>this.Fh(t,s)).join(this.Rh.scope)}}Gh(t){return t.split(this.Rh.scope).map(t=>this.cs(t))}zi(instructions){return Array.isArray(instructions)?instructions.map(t=>this.qi(t)).join(this.Rh.scope):this.zi([instructions])}mh(t,s){return t&&(s=`/${t}${this.Rh.scope}${s}`),s}Ih(t){return{Vh:t===this.Rh.clear||t.startsWith(this.Rh.clear+this.Rh.add),Ph:t.startsWith(this.Rh.clear)?t.slice(2):t}}Bh(t){let s=t.slice().sort((t,s)=>s.split(this.Rh.scope).length-t.split(this.Rh.scope).length),i=[];if((s=s.map(value=>`${this.Rh.scope}${value}${this.Rh.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.Rh.scope).length-s.split(this.Rh.scope).length),i}Lh(t,s=0){const i=t.slice();return s&&i.unshift(this.Si),i.join(this.Rh.Uh)}Jh(t){let component,s,i,e;const[n,r]=t.split(this.Rh.viewport);void 0===r?([component,...i]=n.split(this.Rh.i),component.endsWith(this.Rh.xt)&&(e=1,component=component.slice(0,-this.Rh.xt.length))):(component=n,[s,...i]=r.split(this.Rh.i),s.endsWith(this.Rh.xt)&&(e=1,s=s.slice(0,-this.Rh.xt.length)));let o=i.length?i.join(this.Rh.i):void 0;return this.Rh.zh.length&&o&&o.endsWith(this.Rh.zh)&&(o=o.slice(0,-this.Rh.zh.length)),new c(component,s,o,e)}Fh(t,s=0){if("string"==typeof t)return this.qi(this.cs(t),s);{let i=t.It;return null==t.kt||s||(i+=this.Rh.viewport+t.kt),t.Ht&&(i+=this.Rh.i+t.Ht+this.Rh.zh),i}}}];let I=t("NavCustomElement",class{constructor(router){this.router=router,this.name=null,this.ps=null,this.level=0}get Qh(){const t=this.router.ah[this.name];return t?t.ps:[]}active(t){return"Active"}});e([bindable],I.prototype,"name",void 0),e([bindable],I.prototype,"routes",void 0),e([bindable],I.prototype,"level",void 0),I=t("NavCustomElement",e([inject(P,INode),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],I));class k{constructor(router,t,s){this.name="default",this.scope=null,this.Ii=null,this.default=null,this.ki=null,this.Hi=null,this.Ei=null,this.viewport=null,this.router=router,this.gi=t,this.Mh=s}Wh(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.Mh.Kh(dom,i.description,s,i);template.Xh=createRenderContext(dom,s,i.description.dependencies,i),template.Wh(this,host,parts)}bound(){this.connect()}Yh(){this.disconnect()}connect(){const t={scope:this.gi.hasAttribute("scope")};this.Ii&&this.Ii.length&&(t.Ii=this.Ii),this.default&&this.default.length&&(t.default=this.default),this.gi.hasAttribute("no-link")&&(t.ki=1),this.gi.hasAttribute("no-history")&&(t.Hi=1),this.gi.hasAttribute("stateful")&&(t.Ei=1),this.viewport=this.router.sh(this.name,this.gi,this.fi.context,t)}disconnect(){this.router.hh(this.viewport,this.gi,this.fi.context)}Fi(t){this.viewport&&this.viewport.Fi(t)}Gi(t){this.viewport&&this.viewport.Gi(t)}Qi(t){this.viewport&&this.viewport.Qi(t)}Mi(t){this.viewport&&this.viewport.Mi(t)}}t("ViewportCustomElement",k),k.inject=[P,INode,IRenderingEngine],e([bindable],k.prototype,"name",void 0),e([bindable],k.prototype,"scope",void 0),e([bindable],k.prototype,"usedBy",void 0),e([bindable],k.prototype,"default",void 0),e([bindable],k.prototype,"noLink",void 0),e([bindable],k.prototype,"noHistory",void 0),e([bindable],k.prototype,"stateful",void 0),CustomElementResource.Zh({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> ${scope ? "[new scope]" : ""} : <b>${viewport.content && viewport.content.componentName()}</b></div></template>'},k);const H=t("RouterRegistration",P),DefaultComponents=t("DefaultComponents",[H]),DefaultResources=(t("ViewportCustomElementRegistration",k),t("NavCustomElementRegistration",I),t("DefaultResources",[k,I]));t("RouterConfiguration",{register:t=>t.register(...DefaultComponents,...DefaultResources),te(){return this.register(DI.te())}})}}});
