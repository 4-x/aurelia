function parseQuery(t){const s={},i=[];if(!t||!t.length)return{t:s,list:i};const e=t.replace("+"," ").split("&");for(const t of e){const e=t.split("="),n=decodeURIComponent(e.shift());if(!e.length){i.push(n);continue}const value=decodeURIComponent(e.shift());s[n]=value}return{t:s,list:i}}function mergeParameters(t,s,i){const e=parseQuery(s),n=parseQuery(t),h=Object.assign({},e.t,n.t),r=[...e.list,...n.list];if(r.length&&i&&i.length)for(const t of i)h[t]=r.shift();let o;return r.length&&Object.keys(h).length&&(h["s"]=r.splice(0,r.length)),{i:h,h:r,o:o=r.length?r:h}}function __decorate(t,s,i,e){var n,h,r=arguments.length,o=3>r?s:null===e?e=Object.getOwnPropertyDescriptor(s,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,e);else for(h=t.length-1;h>=0;h--)(n=t[h])&&(o=(3>r?n(o):r>3?n(s,i,o):n(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}var ContentStatus,ReentryBehavior;import{Reporter,PLATFORM,IContainer,buildQueryString,parseQueryString,DI,inject}from"@aurelia/kernel";import{CustomElementResource,IObserverLocator,Aurelia,bindable,customElement,IDOM,createRenderContext,INode,IRenderingEngine}from"@aurelia/runtime";class QueuedBrowserHistory{constructor(){this.l=(async t=>this.u(this,"popstate",[t])),this.window=window,this.history=window.history,this.p=[],this.m=0,this.g=null,this.v=null,this.R=null,this.C=null}S(t){if(this.m)throw Reporter.error(2003);this.m=1,this.v=t,PLATFORM.V.add(this.I,this),this.window.addEventListener("popstate",this.l)}$(){this.window.removeEventListener("popstate",this.l),PLATFORM.V.remove(this.I,this),this.v=null,this.m=0}get length(){return this.history.length}get state(){return this.history.state}get P(){return this.history.P}async go(t,s=0){if(!s)return this.u(this,"_go",[t],1);const i=this.u(this,"suppressPopstate",[],1);return this.u(this.history,"go",[t]).catch(t=>{throw t}),i}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){return this.u(this.history,"pushState",[t,s,i])}async replaceState(t,s,i){return this.u(this.history,"replaceState",[t,s,i])}async H(t){if(this.C){const t=this.C;this.C=null,t()}else{if(this.R){const t=this.R;this.R=null,t(),await Promise.resolve()}this.v(t)}}N(t,s){this.R=s,this.history.go(t)}O(t){this.C=t}u(t,s,i,e=0){let n;const h=new Promise(t=>{n=t});return e&&(i.push(n),n=null),this.p.push({target:t,k:s,t:i,resolve:n}),h}async I(t){if(!this.p.length||null!==this.g)return;this.g=this.p.shift();const s=this.g.target[this.g.k];Reporter.write(1e4,"DEQUEUE",this.g.k,this.g.t),s.apply(this.g.target,this.g.t);const i=this.g.resolve;this.g=null,i&&i()}}class HistoryBrowser{constructor(){this._=(async()=>{const t=this.A(),s=this.j();Reporter.write(1e4,"path changed to",t,this.T,this.D);const i={};let e,n=this.L("HistoryEntry");if(this.T&&this.T.path===t){i.B=1;const t=this.q?this.D.index:this.history.length-this.U;e=this.D,this.D=this.T,this.D.index=t,this.q?(this.F=0,this.G[this.D.index]=this.D,this.M?(i.J=1,this.M=0):i.W=1,this.q=0):(this.F=1,this.G=this.G.slice(0,this.D.index),this.G.push(this.D)),await this.K({X:this.G,Y:this.U,Z:this.D})}else this.G=this.G||this.L("HistoryEntries")||[],this.U=this.U||this.L("HistoryOffset")||0,n||this.D?n?this.D?n.index>this.D.index?i.tt=1:this.D.index>n.index&&(i.st=1):i.J=1:i.B=1:(i.B=1,i.it=1,this.U=this.history.length),n||(n={path:t,et:null,index:this.history.length-this.U,nt:s},i.it&&(n.ht=1),this.G=this.G.slice(0,n.index),this.G.push(n),await this.K({X:this.G,Y:this.U,Z:n})),this.F=this.D?n.index-this.D.index:0,e=this.D,this.D=n;this.T=null,Reporter.write(1e4,"navigated",this.L("HistoryEntry"),this.G,this.L("HistoryOffset")),this.v(this.D,i,e)}),this.location=window.location,this.history=new QueuedBrowserHistory,this.D=null,this.G=null,this.U=null,this.rt=null,this.T=null,this.options=null,this.m=0,this.F=null,this.q=0,this.M=0}S(t){if(this.m)throw Reporter.error(0);return this.m=1,this.options=Object.assign({},t),this.history.S(this._),Promise.resolve().then(()=>{this.ot(this.A(),1).catch(t=>{throw t})})}$(){this.history.$(),this.m=0}at(t,s,i){return this.T={path:t,et:null,title:s,data:i},this.ot(t)}replace(t,s,i){return this.q=1,this.T={path:t,et:null,title:s,data:i},this.ot(t,1)}async refresh(){if(this.D)return this.M=1,this.replace(this.D.path,this.D.title,this.D.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){const t=this.F;return t?(this.F=0,this.history.go(-t,1)):this.replace(this.rt.path,this.rt.title,this.rt.data)}async pop(){await this.history.go(-1,1);const t=""+this.location,s=this.history.state;if(!s.Z.ht)return await this.history.go(-1,1),this.history.pushState(s,null,t)}async K(t,value){const{pathname:s,search:i,hash:e}=this.location;let n=Object.assign({},this.history.state);return"string"==typeof t?n[t]=JSON.parse(JSON.stringify(value)):n=Object.assign({},n,JSON.parse(JSON.stringify(t))),this.history.replaceState(n,null,`${s}${i}${e}`)}L(t){return Object.assign({},this.history.state)[t]}lt(t){return this.D.title=t,this.G[this.D.index]=this.D,this.K({X:this.G,Z:this.D})}ut(t,s,i){if(i.index!==this.D.index)return;const e=`#${t}`,{pathname:n,search:h,hash:r}=this.location;if(e===r&&this.D.path===t&&this.D.et===s)return;this.D.path=t,this.D.et=s;const o=Object.assign({},this.history.state,{Z:this.D,X:this.G});return this.history.replaceState(o,null,`${n}${h}${e}`)}ct(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get pt(){return this.G?this.G.slice(0,this.D.index+1).map(value=>value.title):[]}A(){return this.location.hash.substring(1).split("?")[0]}async ot(t,s=0){const{pathname:i,search:e}=this.location,n=`#${t}`;return s?(this.rt=this.D,await this.history.replaceState({},null,`${i}${e}${n}`)):await this.history.pushState({},null,`${i}${e}${n}`),this._()}j(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}v(t,s,i){const e=Object.assign({},t,s);e.ft=i,Reporter.write(1e4,"callback",t,s),this.options.v&&this.options.v(e)}}class LinkHandler{constructor(){this.m=0,this.wt=(t=>{const s=LinkHandler.dt(t);s.gt&&(t.preventDefault(),this.options.v(s))}),this.document=document}static dt(t){const s={gt:0,href:null,anchor:null},i=LinkHandler.vt(t.target);if(!i||!LinkHandler.yt(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const e=i.getAttribute("href");return s.anchor=i,s.href=e,s.gt=1===t.which,s}static vt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static yt(t){const s=t.getAttribute("target");return!s||s===LinkHandler.window.name||"_self"===s}S(t){if(this.m)throw Reporter.error(2004);this.m=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.wt,1)}$(){this.document.removeEventListener("click",this.wt,1),this.m=0}}class ViewportInstruction{constructor(component,t,s,i=0,e=null){this.component=null,this.Rt=null,this.viewport=null,this.Ct=null,this.bt=null,this.t=null,this.Et=null,this.St(component),this.Vt(t),this.It(s),this.$t=i,this.Pt=e}St(component){"string"==typeof component?(this.Rt=component,this.component=null):(this.component=component,this.Rt=component.description.name)}Vt(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.Ct=t,this.viewport=null):(this.viewport=t,null!==t&&(this.Ct=t.name))}It(t){void 0!==t&&""!==t||(t=null),"string"==typeof t?(this.bt=t,this.t={id:t}):this.t=t}Ht(t){if(null!==this.component)return this.component;const s=t.get(IContainer),i=s.Nt(CustomElementResource.Ot(this.Rt));return null!==i?i._t(s).kt:null}At(router){return null!==this.viewport?this.viewport:router.jt()[this.Ct]}Tt(t,s=0,i=0){return s&&this.bt!==t.bt?0:i?this.component===t.component:this.Rt===t.Rt}}class NavRoute{constructor(t,s){this.active="",this.Dt=t,Object.assign(this,{title:s.title,children:null,Lt:s.Lt,active:""}),this.instructions=this.xt(s.Bt),this.link=this.Qt(this.instructions),this.zt=s.qt?this.Qt(this.xt(s.qt)):this.link,this.Ut=this.Dt.router.Ft.get(IObserverLocator),this.Gt=this.Ut.Mt(0,this.Dt.router,"activeComponents"),this.Gt.subscribe(this)}get Jt(){return this.children&&this.children.length?"nav-has-children":""}Wt(){this.active=this.link&&this.link.length?this.Kt():"nav-active"===this.active?"nav-active":this.Xt()?"nav-active-child":""}Kt(){const t=this.Dt.router.Zt.Yt(this.zt),s=this.Dt.router.ts.map(t=>this.Dt.router.Zt.ss(t));for(const component of t)if(!s.find(t=>t.Tt(component)))return"";return"nav-active"}es(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}Qt(instructions){return this.Dt.router.Zt.ns(instructions)}xt(t){if(!Array.isArray(t))return this.xt([t]);const instructions=[];for(const s of t)instructions.push("string"==typeof s?this.Dt.router.Zt.ss(s):s instanceof ViewportInstruction?s:s.component?new ViewportInstruction(s.component,s.viewport,s.t):new ViewportInstruction(s));return instructions}Xt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Xt())return 1;return 0}}class Nav{constructor(router,name,t=[]){this.router=router,this.name=name,this.hs=t}rs(t){for(const s of t)this.os(this.hs,s)}os(t,s){const i=new NavRoute(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.os(i.children,t)}}}class HandlerEntry{constructor(t,s){this.wt=t,this.names=s}}class RouteGenerator{constructor(t,s){this.as=t,this.ls=s}}class TypesRecord{constructor(){this.us=0,this.cs=0,this.ps=0}}class RecognizeResult{constructor(t,s,i){this.wt=t,this.fs=s,this.ms=i}}class CharSpec{constructor(t,s,i){this.ws=t,this.ds=s,this.repeat=i}gs(t){return this.ds===t.ds&&this.ws===t.ws}}class State{constructor(t){this.vs=t,this.ys=[]}put(t){let s=this.ys.find(s=>s.vs.gs(t));return void 0===s&&(s=new State(t),this.ys.push(s),t.repeat&&s.ys.push(s)),s}}const specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],escapeRegex=RegExp(`(\\${specials.join("|\\")})`,"g");class StaticSegment{constructor(t,s){this.name=t,this.Rs=t,this.Cs=s,this.optional=0}bs(t){const s=this.Rs,i=s.length;let e=0,n="";if(this.Cs)for(;i>e;++e)n=s.charAt(e),t(new CharSpec(null,n,0));else for(;i>e;++e)n=s.charAt(e),t(new CharSpec(null,n.toUpperCase()+n.toLowerCase(),0))}Es(){return this.Rs.replace(escapeRegex,"\\$1")}Ss(t,s){return this.Rs}}class DynamicSegment{constructor(name,optional){this.name=name,this.optional=optional}bs(t){t(new CharSpec("/",null,1))}Es(){return"([^/]+)"}Ss(t,s){return s[this.name]=1,t[this.name]}}class StarSegment{constructor(name){this.name=name,this.optional=0}bs(t){t(new CharSpec("",null,1))}Es(){return"(.+)"}Ss(t,s){return s[this.name]=1,t[this.name]}}class EpsilonSegment{bs(t){}Es(){return""}Ss(t,s){return""}}class RouteRecognizer{constructor(){this.Vs=new State,this.names={},this.hs=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.Vs;const i=[];let e="^";const n=new TypesRecord,h=[],r=t.wt.name;let o=1,a=t.path;"/"===a.charAt(0)&&(a=a.slice(1));const l=[],u=a.split("/");let c,p;for(let r=0,a=u.length;a>r;++r){let a=(c=u[r]).match(/^:([^?]+)(\?)?$/);if(a){const[,name,optional]=a;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);l.push(p=new DynamicSegment(name,!!optional)),h.push(name),n.cs++}else if(a=c.match(/^\*(.+)$/))l.push(p=new StarSegment(a[1])),h.push(a[1]),n.ps++;else{if(""===c){l.push(new EpsilonSegment);continue}l.push(p=new StaticSegment(c,t.Cs)),n.us++}const f=s.put(new CharSpec(null,"/",0));let m=f;p.bs(t=>{m=m.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].ys.push(f);p.optional?(i.push(m),e+=`(?:/${p.Es()})?`):(s=m,e+=`/${p.Es()}`,i.length=0,o=0)}o&&(s=s.put(new CharSpec(null,"/",0)),e+="/?");const f=[new HandlerEntry(t.wt,h)];if(this.hs.set(t.wt,new RouteGenerator(l,f)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new RouteGenerator(l,f))}for(let s=0;i.length>s;s++){const h=i[s];h.ls=f,h.Es=RegExp(`${e}$`,t.Cs?"":"i"),h.types=n}return s.ls=f,s.Es=RegExp(`${e}$`,t.Cs?"":"i"),s.types=n,s}Is(t){return"string"==typeof t?this.names[t]:this.hs.get(t)}$s(t){const s=this.Is(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.ls]}Ps(t){return!!this.Is(t)}Ss(t,s){const i=this.Is(t);if(!i)throw Error(`There is no route named ${t}`);const e=i.ls[0].wt;if(e.Hs)return e.href;const n=Object.assign({},s),h=i.as,r={};let o="";for(let s=0,i=h.length;i>s;s++){const i=h[s];if(i instanceof EpsilonSegment)continue;const e=i.Ss(n,r);if(null==e){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=e}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(n,t);const a=buildQueryString(n);return o+(a?`?${a}`:"")}Ns(t){let s=[this.Vs],i={},e=0,n=t;const h=n.indexOf("?");if(-1!==h){const t=n.slice(h+1);n=n.slice(0,h),i=parseQueryString(t)}"/"!==(n=decodeURI(n)).charAt(0)&&(n=`/${n}`);let r=n.length;r>1&&"/"===n.charAt(r-1)&&(n=n.slice(0,-1),e=1,--r);for(let t=0;r>t;++t){const i=[],e=n.charAt(t);if(s.forEach(t=>{t.ys.forEach(t=>{null!==t.vs.ds?-1!==t.vs.ds.indexOf(e)&&i.push(t):null!==t.vs.ws&&-1===t.vs.ws.indexOf(e)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].ls&&o.push(s[t]);o.sort((t,s)=>{if(t.types.ps!==s.types.ps)return t.types.ps-s.types.ps;if(t.types.ps){if(t.types.us!==s.types.us)return s.types.us-t.types.us;if(t.types.cs!==s.types.cs)return s.types.cs-t.types.cs}return t.types.cs!==s.types.cs?t.types.cs-s.types.cs:t.types.us!==s.types.us?s.types.us-t.types.us:0});const a=o[0];if(a&&a.ls){e&&"(.+)$"===a.Es.source.slice(-5)&&(n=`${n}/`);const t=n.match(a.Es);let s=1;const h=[];return h.Os=i,a.ls.forEach(i=>{const e={};i.names.forEach(name=>{e[name]=t[s++]}),h.push(new RecognizeResult(i.wt,e,i.names.length>0))}),h}}}class InstructionResolver{S(t){this.ks=Object.assign({viewport:"@",_s:"+",scope:"/",$t:"!",t:"(",As:")",js:"&",add:"+",clear:"-",action:"."},t.ks)}get Ts(){return this.ks.clear}Yt(instructions){return null===instructions||""===instructions?[]:(instructions.startsWith("/")&&(instructions=instructions.slice(1)),instructions.split(this.ks._s).map(t=>this.ss(t)))}ss(t){const instructions=t.split(this.ks.scope).map(t=>this.Ds(t));for(let t=0;instructions.length-1>t;t++)instructions[t].Pt=instructions[t+1];return instructions[0]}ns(instructions){return instructions.map(t=>this.Ls(t)).join(this.ks._s)}Ls(t,s=0){if("string"==typeof t)return this.xs(t,s);{const instructions=[t];for(;t=t.Pt;)instructions.push(t);return instructions.map(t=>this.xs(t,s)).join(this.ks.scope)}}Bs(t){return t.split(this.ks.scope).map(t=>this.ss(t))}Qs(instructions){return Array.isArray(instructions)?instructions.map(t=>this.Ls(t)).join(this.ks.scope):this.Qs([instructions])}zs(t,s){return t&&(s=`/${t}${this.ks.scope}${s}`),s}qs(t){return{Us:t===this.ks.clear||t.startsWith(this.ks.clear+this.ks.add),Fs:t.startsWith(this.ks.clear)?t.slice(2):t}}Gs(t){let s=t.slice().sort((t,s)=>s.split(this.ks.scope).length-t.split(this.ks.scope).length),i=[];if((s=s.map(value=>`${this.ks.scope}${value}${this.ks.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.ks.scope).length-s.split(this.ks.scope).length),i}Ms(t,s=0){const i=t.slice();return s&&i.unshift(this.Ts),i.join(this.ks._s)}Ds(t){let component,s,i,e;const[n,h]=t.split(this.ks.viewport);void 0===h?([component,...i]=n.split(this.ks.t),component.endsWith(this.ks.$t)&&(e=1,component=component.slice(0,-this.ks.$t.length))):(component=n,[s,...i]=h.split(this.ks.t),s.endsWith(this.ks.$t)&&(e=1,s=s.slice(0,-this.ks.$t.length)));let r=i.length?i.join(this.ks.t):void 0;return this.ks.As.length&&r&&r.endsWith(this.ks.As)&&(r=r.slice(0,-this.ks.As.length)),new ViewportInstruction(component,s,r,e)}xs(t,s=0){if("string"==typeof t)return this.Ls(this.ss(t),s);{let i=t.Rt;return null===t.Ct||s||(i+=this.ks.viewport+t.Ct),t.bt&&(i+=this.ks.t+t.bt+this.ks.As),i}}}class RouteTable{constructor(){this.Js=(t=>t),this.Ws=(instructions=>instructions)}}(function(t){t[t.Ks=0]="none",t[t.Xs=1]="created",t[t.loaded=2]="loaded",t[t.Ys=3]="initialized",t[t.Zs=4]="added"})(ContentStatus||(ContentStatus={})),(function(t){t.default="default",t.ti="disallow",t.si="enter",t.refresh="refresh"})(ReentryBehavior||(ReentryBehavior={}));class ViewportContent{constructor(t=null,s=null,i=null,e=null){this.content=t,this.t=s,this.ii=i,this.component=null,this.ei=0,this.ni=0,this.hi=0,this.ri=0,null!==this.content&&"string"==typeof this.content&&null!==e&&(this.content=this.Ht(e))}oi(t){return"string"==typeof t.content&&this.Rt()===t.content||"string"!=typeof t.content&&this.content===t.content}ai(t){return this.t===t.t&&this.ii.nt===t.ii.nt}li(){return"reentryBehavior"in this.component?this.component.li:"default"}ui(t){return("string"==typeof t.content&&this.Rt()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.t===t.t}ci(t){0===this.ei&&(this.hi||(this.component=this.pi(t)),this.ei=1)}fi(){1===this.ei&&(this.ei=0)}mi(t,s){if(!this.component)return Promise.resolve(0);if(!this.component.mi)return Promise.resolve(1);const i=mergeParameters(this.t,this.ii.nt,this.content.t);this.ii.t=i.i,this.ii.h=i.h;const e=this.component.mi(i.o,this.ii,s);return Reporter.write(1e4,"viewport canEnter",e),"boolean"==typeof e?Promise.resolve(e):"string"==typeof e?Promise.resolve([new ViewportInstruction(e,t)]):e}wi(t){if(!this.component||!this.component.wi)return Promise.resolve(1);const s=this.component.wi(this.ii,t);return Reporter.write(1e4,"viewport canLeave",s),"boolean"==typeof s?Promise.resolve(s):s}async si(t){if(this.ri||1===this.ei&&!this.ni){if(this.component.si){const s=mergeParameters(this.t,this.ii.nt,this.content.t);this.ii.t=s.i,this.ii.h=s.h,await this.component.si(s.o,this.ii,t)}this.ni=1}}async di(t){4===this.ei&&this.ni&&(this.component.di&&await this.component.di(this.ii,t),this.ni=0)}loadComponent(t,s){if(1===this.ei&&this.ni)return this.hi||this.component.gi(0,t,s),this.ei=2,Promise.resolve()}vi(){2===this.ei&&(this.ei=1)}yi(){2===this.ei&&(this.hi||this.component.Ri(2560,null),this.ei=3)}Ci(t=0){3===this.ei&&(t||(this.component.bi(5120),this.ei=2))}addComponent(t){if(3===this.ei){if(this.component.Ei(512),this.hi){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.ei=4}}Si(t,s=0){if(4===this.ei&&!this.ni){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.Vi(1024),this.ei=3}}async Ii(t,s,i=0){switch(this.ei){case 4:await this.di(s),this.Si(t,i);case 3:this.Ci(i);case 2:this.vi();case 1:this.fi()}}Rt(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}Ht(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(IContainer),i=s.Nt(CustomElementResource.Ot(this.content));return null!==i?i._t(s).kt:null}}pi(t){if(null===this.content)return null;const component=this.Rt();return t.get(IContainer).get("string"!=typeof component?component:CustomElementResource.Ot(component))}}class Viewport{constructor(router,name,t,s,i,e,n){this.router=router,this.name=name,this.$i=t,this.context=s,this.Pi=i,this.scope=e,this.options=n,this.clear=0,this.content=new ViewportContent,this.Hi=null,this.Ni=null,this.Oi=null,this.cache=[],this.enabled=1}ki(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.Zt.Ts)this.clear=1,t=null;else{const s=this.router.Zt.ss(t);t=s.Rt,i=s.bt}if(this.Hi=new ViewportContent(t,i,s,this.context),this.options._i){const t=this.cache.find(t=>this.Hi.ui(t));t?(this.Hi=t,this.Hi.hi=1):this.cache.push(this.Hi)}return!this.content.oi(this.Hi)||s.J||"refresh"===this.content.li()?1:"disallow"!==this.content.li()?this.content.ai(this.Hi)&&"enter"!==this.content.li()?0:(this.content.ri=1,this.Hi.content=this.content.content,this.Hi.component=this.content.component,this.Hi.ei=this.content.ei,this.Hi.ri=this.content.ri,1):void 0}Ai(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.$i&&(this.scope.$i=t),this.$i!==t&&(this.Oi=Object.assign({},this),this.ji(),this.$i=t,i&&i.Ti&&(this.options.Ti=i.Ti),i&&i.default&&(this.options.default=i.default),i&&i.Di&&(this.options.Di=i.Di),i&&i.Li&&(this.options.Li=i.Li),i&&i._i&&(this.options._i=i._i),this.Ni&&this.Ni()),s&&(s.Ct=this.name),this.context!==s&&(this.context=s),this.content.component||this.Hi&&this.Hi.component||!this.options.default||this.router.xi(this.options.default,this)}remove(t,s){return this.$i===t&&this.context===s?(this.content.component&&this.content.Ii(this.$i,this.Hi?this.Hi.ii:null,this.options._i).catch(t=>{throw t}),1):0}async wi(){return this.content.wi(this.Hi.ii)}async mi(){return this.clear?1:this.Hi.content?(await this.Bi(),this.Hi.ci(this.context),this.Hi.mi(this,this.content.ii)):0}async si(){return Reporter.write(1e4,"Viewport enter",this.name),this.clear?1:this.Hi&&this.Hi.component?(await this.Hi.si(this.content.ii),await this.Hi.loadComponent(this.context,this.$i),this.Hi.yi(),1):0}async Qi(){return Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&!this.Hi.component&&(await this.content.di(this.Hi.ii),this.content.Si(this.$i,this.options._i),this.content.Ci(this.options._i),this.content.vi(),this.content.fi()),this.Hi.component&&(this.Hi.addComponent(this.$i),this.content.component&&(await this.content.di(this.Hi.ii),this.content.ri||(this.content.Si(this.$i,this.options._i),this.content.Ci(this.options._i),this.content.vi(),this.content.fi())),this.content=this.Hi,this.content.ri=0),this.clear&&(this.content=new ViewportContent(null,null,this.Hi.ii)),this.Hi=null,1}zi(){this.Oi=null}async qi(){await this.Hi.Ii(this.$i,this.Hi?this.Hi.ii:null,this.options._i),this.Oi&&Object.assign(this,this.Oi)}description(t=0){if(this.content.content){const component=this.content.Rt();if(t||this.scope||this.options.Ui)return this.router.Zt.Ls(new ViewportInstruction(component,this,this.content.t,null!==this.scope));const s=this.Pi.Fi([new ViewportInstruction(component)]);return this.router.Zt.Ls(new ViewportInstruction(component,s&&s.Gi&&s.Gi.length?null:this,this.content.t))}}Mi(t=0){const s=[this.Pi.Ji(t),this.description(t)];return this.router.Zt.Qs(s.filter(value=>value&&value.length))}Wi(component){let t=this.options.Ti||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}Ki(component){if("-"===component||null===component)return 1;let t=this.options.Ti;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}Xi(t){this.content.component&&this.content.yi()}Yi(t){Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.Hi),this.enabled=1,this.content.component&&this.content.addComponent(this.$i)}Zi(t){Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.Si(this.$i,this.options._i),this.enabled=0}te(t){this.content.component&&this.content.Ci(this.options._i)}ji(){this.options={},this.content=new ViewportContent,this.cache=[]}async Bi(){return this.$i?Promise.resolve():new Promise(t=>{this.Ni=t})}}class Scope{constructor(router,t,s,i){this.router=router,this.$i=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.se=[],this.ie=null,this.parent&&this.parent.ee(this)}ne(){return this.se.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}Fi(t){const instructions=[];let s=0;t?(this.ie={},this.Gi=t.slice()):this.Gi||(this.Gi=[]),this.ie=Object.assign({},this.ne(),this.ie);for(let t=0;this.Gi.length>t;t++){const i=this.Gi[t];for(const name in this.ie){const e=this.ie[name];if(e&&e.Wi(i.Rt)){const n=this.he(i,e);instructions.push(...n.Gi),s=s||n.re,this.ie[name]=null,this.Gi.splice(t--,1);break}}}for(let t=0;this.Gi.length>t;t++){const i=this.Gi[t],name=i.Ct;if(!name||!name.length)continue;const e=i.$t;this.ne()[name]||(this.oe(name,null,null,{scope:e,Ui:1}),this.ie[name]=this.ne()[name]);const n=this.ie[name];if(n&&n.Ki(i.Rt)){const e=this.he(i,n);instructions.push(...e.Gi),s=s||e.re,this.ie[name]=null,this.Gi.splice(t--,1)}}for(let t=0;this.Gi.length>t;t++){const i=this.Gi[t],e=[];for(const name in this.ie){const t=this.ie[name];t&&t.Ki(i.Rt)&&e.push(t)}if(1===e.length){const n=e.shift(),h=this.he(i,n);instructions.push(...h.Gi),s=s||h.re,this.ie[n.name]=null,this.Gi.splice(t,1);break}}if(s=s||this.Gi.length>0,!t)for(const t of this.children){const i=t.Fi();instructions.push(...i.Gi),s=s||i.re}return{Gi:instructions,re:s}}he(t,s){t.Vt(s);const instructions=[t];let i=0;if(t.Pt){const e=(s.scope||s.Pi).Fi([t.Pt]);instructions.push(...e.Gi),i=i||e.re}return{Gi:instructions,re:i}}oe(name,t,s,i){let e=this.ne()[name];if(t&&e&&null!==e.$i&&e.$i!==t&&(e.enabled=0,(e=this.se.find(s=>s.name===name&&s.$i===t))&&(e.enabled=1)),!e){let n;i.scope&&(n=new Scope(this.router,t,s,this),this.router.ae.push(n)),e=new Viewport(this.router,name,null,null,this,n,i),this.se.push(e)}return(t||s)&&e.Ai(t,s,i),e}le(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.ue(t.scope),this.se.splice(this.se.indexOf(t),1)),Object.keys(this.se).length}ue(){for(const t of this.children)t.ue();const t=this.ne();for(const name in t)this.router.le(t[name],null,null)}ee(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}ce(t=0,s=0){const i=[];for(const e in this.ne()){const n=this.ne()[e];(n.options.Li||n.options.Di&&!t)&&!s||i.push(n.Mi(t))}for(const s of this.children)i.push(...s.ce(t));return i.filter(value=>value&&value.length)}jt(){const t=this.se.filter(t=>t.enabled);for(const s of this.children)t.push(...s.jt());return t}Ji(t=0){if(!this.$i||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.pe(this.context.get(IContainer).parent);for(;i&&i.Pi===this.parent;)s.unshift(i.description(t)),i=this.pe(i.context.get(IContainer).parent);return s.unshift(this.parent.Ji(t)),this.router.Zt.Qs(s.filter(value=>value&&value.length))}pe(t){const s=Object.values(this.ne());for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}const IRouteTransformer=DI.me("IRouteTransformer").fe(t=>t.singleton(RouteTable)),IRouter=DI.me("IRouter").fe(t=>t.singleton(Router));class Router{constructor(t,s){this.Ft=t,this.ae=[],this.we={},this.ts=[],this.de=[],this.m=0,this.ge=[],this.ve=null,this.ye=null,this.Re=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.Ce(t.anchor).Ji();s=this.Zt.zs(i,s)}this.be.ct(s)}),this.be=new HistoryBrowser,this.Ee=new LinkHandler,this.Zt=new InstructionResolver,this.Se=s}get Ve(){return null!==this.ve}S(t){if(this.m)throw Reporter.error(2001);return this.m=1,this.options=Object.assign({v:t=>{this.Ie(t)},Js:this.Se.Js,Ws:this.Se.Ws},t),this.Zt.S({ks:this.options.ks}),this.Ee.S({v:this.Re}),this.be.S(this.options).catch(t=>{throw t})}$(){if(!this.m)throw Reporter.error(2e3);this.Ee.$(),this.be.$()}Ie(t){this.ge.push(t),this.$e().catch(t=>{throw t})}async $e(){if(null!==this.ve||!this.ge.length)return Promise.resolve();const t=this.ge.shift();this.ve=t,this.options.Pe&&this.options.Pe(t);let s=0;(t.st||t.tt)&&t.et&&(t.path=t.et,s=1);let i=t.path;if(this.options.Js&&!s){const t=this.options.Js(i,this);i=Array.isArray(t)?this.Zt.ns(t):t}const{Us:e,Fs:n}=this.Zt.qs(i);e&&(i=n);const h=parseQuery(t.nt);t.t=h.t,t.h=h.list;const r=this.Zt.Yt(i);if(!r&&!r.length&&!e)return this.ve=null,this.$e();const o=e?this.jt().filter(value=>null!==value.content.component):[],a=this.jt().filter(value=>value.options.default&&null===value.content.component),l=[];let{Gi:u,re:c}=this.He.Fi(r),p=100;for(;u.length||c||a.length;){if(!p--)throw Reporter.error(2002);const s=[];for(const i of u){const e=i.viewport,n=this.Zt.Ls(i,1);e.ki(n,t)&&s.push(e);const h=o.findIndex(value=>value===e);0>h||o.splice(h,1);const r=a.findIndex(value=>value===e);0>r||a.splice(r,1)}for(const i of o)i.ki(this.Zt.Ts,t)&&s.push(i);let i;for(;i=a.shift();)i.ki(i.options.default,t)&&s.push(i);let e=await Promise.all(s.map(value=>value.wi()));if(e.findIndex(value=>0==value)>=0)return this.Ne([...s,...l],t);if((e=await Promise.all(s.map(async value=>{const t=await value.mi();if("boolean"==typeof t)return t?value.si():0;for(const s of t)this.xi(s);return value.qi().catch(t=>{throw t}),1}))).some(t=>0==t))return this.Ne([...s,...l],t);for(const t of s)l.find(value=>value===t)||l.push(t);const n=this.He.Fi();let h;for(u=[];h=this.de.shift();)n.Gi.find(value=>value.viewport===h.viewport)||u.push(h);u=[...u,...n.Gi],c=n.re}await Promise.all(l.map(value=>value.Qi())),await this.Oe(t),t.it||t.ke||!l.every(t=>t.options.Li)||await this.be.pop(),l.forEach(t=>{t.zi()}),this.ye=this.ve,this.ye.ke&&(this.ye.ke=0),this.ve=null,this.$e().catch(t=>{throw t})}xi(t,s){this.ve?t instanceof ViewportInstruction?(t.viewport||(t.viewport=this.jt().find(s=>s.name===t.Ct)),this.de.push(t)):("string"==typeof s&&(s=this.jt().find(t=>t.name===s)),this.de.push(new ViewportInstruction(t,s))):this.ye&&(this.ge.unshift({path:"",et:"",ke:1}),this.$e().catch(t=>{throw t}))}_e(t){return this.Ae(),this.Ce(t)}je(name){return this.jt().find(t=>t.name===name)}oe(name,t,s,i){return Reporter.write(1e4,"Viewport added",name,t),this._e(t).oe(name,t,s,i)}le(t,s,i){const e=t.Pi;e.le(t,s,i)||this.ue(e)}jt(){return this.Ae(),this.He.jt()}ue(t){if(t!==this.He){t.ue();const s=this.ae.indexOf(t);0>s||this.ae.splice(s,1)}}at(t,s,i){if("string"==typeof t)return this.be.at(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.be.replace(t,s,i)}refresh(){return this.be.refresh()}back(){return this.be.back()}forward(){return this.be.forward()}Te(name,t){const s=this.De(name);s&&(s.hs=[]),this.Le(name,t)}Le(name,t){let s=this.we[name];s||(s=this.we[name]=new Nav(this,name)),s.rs(t),this.we[name]=new Nav(s.router,s.name,s.hs)}De(name){return this.we[name]}async Ne(t,s){t.forEach(t=>{t.qi().catch(t=>{throw t})}),s.B?await this.be.pop():await this.be.cancel(),this.ve=null,this.$e().catch(t=>{throw t})}Ae(){if(!this.He){const t=this.Ft.get(Aurelia).root();this.He=new Scope(this,t.xe,t.$context,null),this.ae.push(this.He)}}Ce(t){let s=t;for(;s.parentElement;){const t=this.jt().find(t=>t.$i===s);if(t&&t.Pi)return t.Pi;s=s.parentElement}return this.He}Oe(t){this.ts=this.He.ce(1,1),this.ts=this.Zt.Gs(this.ts);let s=this.He.ce();s=this.Zt.Gs(s);let i=this.Zt.Ms(s);if(this.options.Ws){const t=this.options.Ws(this.Zt.Yt(i),this);i=Array.isArray(t)?this.Zt.ns(t):t}let e=this.He.ce(1);e=this.Zt.Gs(e);const n=t.nt&&t.nt.length?`?${t.nt}`:"";return this.be.ut(i+n,this.Zt.Ms(e,1)+n,t)}}Router.inject=[IContainer,IRouteTransformer];let NavCustomElement=class{constructor(router){this.router=router,this.name=null,this.hs=null,this.level=0}get Be(){const t=this.router.we[this.name];return t?t.hs:[]}active(t){return"Active"}};__decorate([bindable],NavCustomElement.prototype,"name",void 0),__decorate([bindable],NavCustomElement.prototype,"routes",void 0),__decorate([bindable],NavCustomElement.prototype,"level",void 0),NavCustomElement=__decorate([inject(Router,Element),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],NavCustomElement);class ViewportCustomElement{constructor(router,t,s){this.router=router,this.$i=t,this.Qe=s,this.name="default",this.scope=null,this.Ti=null,this.default=null,this.Di=null,this.Li=null,this._i=null,this.viewport=null}ze(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.Qe.qe(dom,i.description,s,i);template.Ue=createRenderContext(dom,s,i.description.dependencies,i),template.ze(this,host,parts)}bound(){this.connect()}Fe(){this.disconnect()}connect(){const t={scope:this.$i.hasAttribute("scope")};this.Ti&&this.Ti.length&&(t.Ti=this.Ti),this.default&&this.default.length&&(t.default=this.default),this.$i.hasAttribute("no-link")&&(t.Di=1),this.$i.hasAttribute("no-history")&&(t.Li=1),this.$i.hasAttribute("stateful")&&(t._i=1),this.viewport=this.router.oe(this.name,this.$i,this.$context,t)}disconnect(){this.router.le(this.viewport,this.$i,this.$context)}Xi(t){this.viewport&&this.viewport.Xi(t)}Yi(t){this.viewport&&this.viewport.Yi(t)}Zi(t){this.viewport&&this.viewport.Zi(t)}te(t){this.viewport&&this.viewport.te(t)}}ViewportCustomElement.inject=[Router,INode,IRenderingEngine],__decorate([bindable],ViewportCustomElement.prototype,"name",void 0),__decorate([bindable],ViewportCustomElement.prototype,"scope",void 0),__decorate([bindable],ViewportCustomElement.prototype,"usedBy",void 0),__decorate([bindable],ViewportCustomElement.prototype,"default",void 0),__decorate([bindable],ViewportCustomElement.prototype,"noLink",void 0),__decorate([bindable],ViewportCustomElement.prototype,"noHistory",void 0),__decorate([bindable],ViewportCustomElement.prototype,"stateful",void 0),CustomElementResource.Ge({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> ${scope ? "[new scope]" : ""} : <b>${viewport.content && viewport.content.componentName()}</b></div></template>'},ViewportCustomElement);const RouterRegistration=Router,DefaultComponents=[Router],ViewportCustomElementRegistration=ViewportCustomElement,NavCustomElementRegistration=NavCustomElement,DefaultResources=[ViewportCustomElement,NavCustomElement],RouterConfiguration={register:t=>t.register(...DefaultComponents,...DefaultResources),Me(){return this.register(DI.Me())}};export{CharSpec,DefaultComponents,DefaultResources,DynamicSegment,EpsilonSegment,HandlerEntry,HistoryBrowser,IRouteTransformer,IRouter,LinkHandler,Nav,NavCustomElement,NavCustomElementRegistration,QueuedBrowserHistory,RecognizeResult,RouteGenerator,RouteRecognizer,Router,RouterConfiguration,RouterRegistration,Scope,StarSegment,State,StaticSegment,TypesRecord,Viewport,ViewportCustomElement,ViewportCustomElementRegistration};
