{"version":3,"file":"index.iife.js","sources":["../src/index.ts"],"sourcesContent":["import { Constructable, DI, IContainer, Key, IRegistry, IResolver, Registration } from '@aurelia/kernel';\nimport { IDOM, IDOMInitializer, ISinglePageApp } from '@aurelia/runtime';\nimport { BasicConfiguration as RuntimeHtmlConfiguration, HTMLDOM } from '@aurelia/runtime-html';\nimport { JSDOM } from 'jsdom';\n\nclass JSDOMInitializer implements IDOMInitializer {\n  public static readonly inject: readonly Key[] = [IContainer];\n\n  private readonly container: IContainer;\n  private readonly jsdom: JSDOM;\n\n  constructor(container: IContainer) {\n    this.container = container;\n    this.jsdom = new JSDOM();\n  }\n\n  public static register(container: IContainer): IResolver<IDOMInitializer> {\n    return Registration.singleton(IDOMInitializer, this).register(container);\n  }\n\n  public initialize(config?: ISinglePageApp<Node>): IDOM {\n    if (this.container.has(IDOM, false)) {\n      return this.container.get(IDOM);\n    }\n    let dom: IDOM;\n    if (config !== undefined) {\n      if (config.dom !== undefined) {\n        dom = config.dom;\n      } else if (config.host.ownerDocument) {\n        dom = new HTMLDOM(\n          this.jsdom.window,\n          config.host.ownerDocument,\n          this.jsdom.window.Node,\n          this.jsdom.window.Element,\n          this.jsdom.window.HTMLElement,\n          this.jsdom.window.CustomEvent\n        );\n      } else {\n        if (config.host !== undefined) {\n          this.jsdom.window.document.body.appendChild(config.host);\n        }\n        dom = new HTMLDOM(\n          this.jsdom.window,\n          this.jsdom.window.document,\n          this.jsdom.window.Node,\n          this.jsdom.window.Element,\n          this.jsdom.window.HTMLElement,\n          this.jsdom.window.CustomEvent\n        );\n      }\n    } else {\n      dom = new HTMLDOM(\n        this.jsdom.window,\n        this.jsdom.window.document,\n        this.jsdom.window.Node,\n        this.jsdom.window.Element,\n        this.jsdom.window.HTMLElement,\n        this.jsdom.window.CustomEvent\n      );\n    }\n    Registration.instance(IDOM, dom).register(this.container);\n    return dom;\n  }\n}\n\nexport const IDOMInitializerRegistration = JSDOMInitializer as IRegistry;\n\n/**\n * Default HTML-specific, jsdom-specific implementations for the following interfaces:\n * - `IDOMInitializer`\n */\nexport const DefaultComponents = [\n  IDOMInitializerRegistration\n];\n\n/**\n * A DI configuration object containing html-specific, jsdom-specific registrations:\n * - `BasicConfiguration` from `@aurelia/runtime-html`\n * - `DefaultComponents`\n */\nexport const BasicConfiguration = {\n  /**\n   * Apply this configuration to the provided container.\n   */\n  register(container: IContainer): IContainer {\n    return RuntimeHtmlConfiguration\n      .register(container)\n      .register(...DefaultComponents);\n  },\n  /**\n   * Create a new container with this configuration applied to it.\n   */\n  createContainer(): IContainer {\n    return this.register(DI.createContainer());\n  }\n};\n"],"names":["JSDOM","Registration","IDOMInitializer","IDOM","HTMLDOM","IContainer","RuntimeHtmlConfiguration","DI"],"mappings":"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"}